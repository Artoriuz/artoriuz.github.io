<!DOCTYPE html>
<html lang="en">

<head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135192850-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-135192850-1');
    </script>

    <title>Mathematically Evaluating mpv's Resampling Algorithms</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="./css/default.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Roboto+Slab&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <hgroup>
            <h1>
                mpv Resampling
            </h1>
            <h2>A sequel in the making</h2>
        </hgroup>
    </header>
    <nav>
        <menu>
            <a href="../index.html">Home</a>
            <a href="https://github.com/Artoriuz">GitHub</a>
            <a href="https://www.linkedin.com/in/jvrchrisostomo/">LinkedIn</a>
        </menu>
    </nav>
    <section>
        <h3 id="introduction">Introduction</h3>
        <p>
            This page is meant to be treated as a follow-up to this scaler comparison done with <a href="https://artoriuz.github.io/blog/imagemagick_resampling.html">ImageMagick</a>. I'm only going to talk about niche topics here, 
            so just refer to that other page if you only want to read about scalers.
        </p>
        <h3 id="upsampling_shaders">Upsampling Shaders</h3>
        <p>
            The mpv community has written several <s>meme</s> shaders you can use to upsample video in real time, and the rationale is that they can potentially achieve higher quality than the built-in methods. I still do not have a good way of 
            automating mpv tests and therefore I'll have to stick to a single test image, which is still going to be violet.png just because I'm familiarised with it. If this is your first time reading these posts, this is what violet.png looks like:
        </p>
        <p>
            <img src="./images/mpv_upscaling/upsampling/violet.png" alt="Violet" class="center" width="960" height="540">
        </p>
        <p>
            The small number of samples under test makes this very unscientific, but it is what it is.
        </p>
        <h3 id="upsampling_methodology">Upsampling Methodology</h3>
        <p>
            The following shaders were "benchmarked":
            <ol>
              <li><a href="https://github.com/bjin/mpv-prescalers">RAVU</a></li>
              <li><a href="https://github.com/bjin/mpv-prescalers">NNEDI3</a></li>
              <li><a href="https://github.com/igv/FSRCNN-TensorFlow">FSRCNNX</a></li>
              <li><a href="https://github.com/bloc97/Anime4K">Anime4K</a></li>
              <li><a href="https://gist.github.com/agyild/82219c545228d70c5604f865ce0b0ce5">FSR</a></li>
            </ol>
            I've also added orthogonal and polar lanczos to the mix just to have a reference point, but feel free to send me any other shaders you would like to get scored. 
            For Anime4K I'm using the <a href="https://github.com/bloc97/Anime4K/blob/815b122284304e6e1e244a8cf6a160eeaa07040c/GLSL_Instructions.md">"C" mode</a> which is defined as <inline_code>Upscale_Denoise -> Upscale</inline_code>.
        </p>
        <p>
            The test image is downsampled with:
        </p>                    
        <code>magick convert violet.png -colorspace rgb -filter box -resize 50% -colorspace srgb downscaled.png</code>
        <p>
            It is then converted to grayscale with:
        </p>
        <code>magick convert downscaled.png -colorspace gray downscaled.png</code>
        <p>
            We need to convert them to grayscale because some of these shaders do not have RGB support.
        </p>
        <p>
            The images were then upsampled back with:
        </p>
        <code>mpv --no-config --vo=gpu-next --no-hidpi-window-scale --window-scale=2.0 --pause=yes --screenshot-format=png --sigmoid-upscaling --deband=no --dither-depth=no --screenshot-high-bit-depth=no --glsl-shader="path/to/meme/shader" downscaled.png</code>
        <h3 id="upsampling_results">Upsampling Results</h3>
        <p>
          <table>
            <tbody>
              <tr>
                <td>Shader/Filter</td>
                <td>MAE</td>
                <td>PSNR</td>
                <td>SSIM</td>
                <td>MS-SSIM</td>
                <td></td>
                <td>MAE (N)</td>
                <td>PSNR (N)</td>
                <td>SSIM (N)</td>
                <td>MS-SSIM (N)</td>
                <td></td>
                <td>Mean</td>
              </tr>
              <tr>
                <td>ravu-lite-ar-r4</td>
                <td>3.46E-03</td>
                <td>41.3618</td>
                <td>0.9887</td>
                <td>0.9987</td>
                <td></td>
                <td>0.9925</td>
                <td>1.0000</td>
                <td>0.9872</td>
                <td>0.9260</td>
                <td></td>
                <td>0.9764</td>
              </tr>
              <tr>
                <td>ravu-zoom-ar-r3</td>
                <td>3.44E-03</td>
                <td>41.2143</td>
                <td>0.9889</td>
                <td>0.9987</td>
                <td></td>
                <td>1.0000</td>
                <td>0.9762</td>
                <td>1.0000</td>
                <td>0.9258</td>
                <td></td>
                <td>0.9755</td>
              </tr>
              <tr>
                <td>ravu-lite-ar-r3</td>
                <td>3.55E-03</td>
                <td>41.0825</td>
                <td>0.9883</td>
                <td>0.9988</td>
                <td></td>
                <td>0.9614</td>
                <td>0.9549</td>
                <td>0.9557</td>
                <td>0.9349</td>
                <td></td>
                <td>0.9517</td>
              </tr>
              <tr>
                <td>ravu-lite-r4</td>
                <td>3.72E-03</td>
                <td>41.2500</td>
                <td>0.9876</td>
                <td>0.9989</td>
                <td></td>
                <td>0.9002</td>
                <td>0.9819</td>
                <td>0.9088</td>
                <td>0.9836</td>
                <td></td>
                <td>0.9437</td>
              </tr>
              <tr>
                <td>ravu-zoom-r3</td>
                <td>3.79E-03</td>
                <td>41.0404</td>
                <td>0.9872</td>
                <td>0.9990</td>
                <td></td>
                <td>0.8743</td>
                <td>0.9481</td>
                <td>0.8779</td>
                <td>1.0000</td>
                <td></td>
                <td>0.9251</td>
              </tr>
              <tr>
                <td>FSRCNNX_x2_8-0-4-1</td>
                <td>3.77E-03</td>
                <td>40.9503</td>
                <td>0.9882</td>
                <td>0.9987</td>
                <td></td>
                <td>0.8803</td>
                <td>0.9336</td>
                <td>0.9531</td>
                <td>0.9026</td>
                <td></td>
                <td>0.9174</td>
              </tr>
              <tr>
                <td>ravu-lite-r3</td>
                <td>3.81E-03</td>
                <td>40.9251</td>
                <td>0.9870</td>
                <td>0.9989</td>
                <td></td>
                <td>0.8649</td>
                <td>0.9295</td>
                <td>0.8666</td>
                <td>0.9748</td>
                <td></td>
                <td>0.9089</td>
              </tr>
              <tr>
                <td>ravu-zoom-ar-r2</td>
                <td>3.63E-03</td>
                <td>40.5841</td>
                <td>0.9877</td>
                <td>0.9987</td>
                <td></td>
                <td>0.9295</td>
                <td>0.8745</td>
                <td>0.9165</td>
                <td>0.9135</td>
                <td></td>
                <td>0.9085</td>
              </tr>
              <tr>
                <td>ravu-lite-ar-r2</td>
                <td>3.73E-03</td>
                <td>40.2182</td>
                <td>0.9872</td>
                <td>0.9988</td>
                <td></td>
                <td>0.8951</td>
                <td>0.8154</td>
                <td>0.8823</td>
                <td>0.9427</td>
                <td></td>
                <td>0.8839</td>
              </tr>
              <tr>
                <td>ravu-zoom-r2</td>
                <td>3.94E-03</td>
                <td>40.4724</td>
                <td>0.9866</td>
                <td>0.9989</td>
                <td></td>
                <td>0.8192</td>
                <td>0.8564</td>
                <td>0.8370</td>
                <td>0.9714</td>
                <td></td>
                <td>0.8710</td>
              </tr>
              <tr>
                <td>ravu-lite-r2</td>
                <td>4.03E-03</td>
                <td>40.0375</td>
                <td>0.9856</td>
                <td>0.9988</td>
                <td></td>
                <td>0.7873</td>
                <td>0.7862</td>
                <td>0.7694</td>
                <td>0.9560</td>
                <td></td>
                <td>0.8247</td>
              </tr>
              <tr>
                <td>FSRCNNX_x2_16-0-4-1</td>
                <td>4.03E-03</td>
                <td>39.9168</td>
                <td>0.9873</td>
                <td>0.9984</td>
                <td></td>
                <td>0.7864</td>
                <td>0.7667</td>
                <td>0.8911</td>
                <td>0.8212</td>
                <td></td>
                <td>0.8163</td>
              </tr>
              <tr>
                <td>EASU</td>
                <td>4.33E-03</td>
                <td>38.8482</td>
                <td>0.9841</td>
                <td>0.9981</td>
                <td></td>
                <td>0.6785</td>
                <td>0.5943</td>
                <td>0.6664</td>
                <td>0.7317</td>
                <td></td>
                <td>0.6677</td>
              </tr>
              <tr>
                <td>lanczos</td>
                <td>4.67E-03</td>
                <td>38.6816</td>
                <td>0.9826</td>
                <td>0.9984</td>
                <td></td>
                <td>0.5566</td>
                <td>0.5674</td>
                <td>0.5631</td>
                <td>0.8072</td>
                <td></td>
                <td>0.6236</td>
              </tr>
              <tr>
                <td>nnedi3-nns64-win8x4</td>
                <td>4.41E-03</td>
                <td>38.6337</td>
                <td>0.9839</td>
                <td>0.9973</td>
                <td></td>
                <td>0.6516</td>
                <td>0.5596</td>
                <td>0.6557</td>
                <td>0.4618</td>
                <td></td>
                <td>0.5822</td>
              </tr>
              <tr>
                <td>nnedi3-nns32-win8x4</td>
                <td>4.46E-03</td>
                <td>38.5214</td>
                <td>0.9835</td>
                <td>0.9973</td>
                <td></td>
                <td>0.6342</td>
                <td>0.5415</td>
                <td>0.6289</td>
                <td>0.4515</td>
                <td></td>
                <td>0.5640</td>
              </tr>
              <tr>
                <td>FSR</td>
                <td>5.10E-03</td>
                <td>39.0008</td>
                <td>0.9817</td>
                <td>0.9981</td>
                <td></td>
                <td>0.4036</td>
                <td>0.6189</td>
                <td>0.5042</td>
                <td>0.7157</td>
                <td></td>
                <td>0.5606</td>
              </tr>
              <tr>
                <td>polar_lanczos</td>
                <td>4.99E-03</td>
                <td>37.9718</td>
                <td>0.9806</td>
                <td>0.9980</td>
                <td></td>
                <td>0.4435</td>
                <td>0.4528</td>
                <td>0.4237</td>
                <td>0.6683</td>
                <td></td>
                <td>0.4971</td>
              </tr>
              <tr>
                <td>Anime4K_C_S</td>
                <td>5.60E-03</td>
                <td>36.3773</td>
                <td>0.9783</td>
                <td>0.9972</td>
                <td></td>
                <td>0.2242</td>
                <td>0.1954</td>
                <td>0.2644</td>
                <td>0.4196</td>
                <td></td>
                <td>0.2759</td>
              </tr>
              <tr>
                <td>Anime4K_C_L</td>
                <td>5.83E-03</td>
                <td>35.9398</td>
                <td>0.9767</td>
                <td>0.9968</td>
                <td></td>
                <td>0.1417</td>
                <td>0.1248</td>
                <td>0.1561</td>
                <td>0.2977</td>
                <td></td>
                <td>0.1801</td>
              </tr>
              <tr>
                <td>Anime4K_C_VL</td>
                <td>5.94E-03</td>
                <td>35.6782</td>
                <td>0.9766</td>
                <td>0.9963</td>
                <td></td>
                <td>0.1015</td>
                <td>0.0826</td>
                <td>0.1499</td>
                <td>0.1305</td>
                <td></td>
                <td>0.1161</td>
              </tr>
              <tr>
                <td>Anime4K_C_M</td>
                <td>6.23E-03</td>
                <td>35.3010</td>
                <td>0.9744</td>
                <td>0.9962</td>
                <td></td>
                <td>0.0000</td>
                <td>0.0217</td>
                <td>0.0000</td>
                <td>0.1077</td>
                <td></td>
                <td>0.0323</td>
              </tr>
              <tr>
                <td>Anime4K_C_UL</td>
                <td>6.15E-03</td>
                <td>35.1667</td>
                <td>0.9750</td>
                <td>0.9959</td>
                <td></td>
                <td>0.0283</td>
                <td>0.0000</td>
                <td>0.0418</td>
                <td>0.0000</td>
                <td></td>
                <td>0.0175</td>
              </tr>
            </tbody>
          </table>
        </p>
    <h3 id="upsampling_commentary">Upsampling Commentary</h3>
    <p>
        The funniest thing about these results is that, according to distortion metrics, Anime4K is actually worse at "recreating the ground truth" than simple resampling filters. 
        The problem seems to be that the shader is too sharp, it does not only ring but also makes the lines thinner. This isn't necessarily bad depending on how blurry your source is, but my test image here isn't 
        blurry at all.
    </p>
    <p>
        The slower variant of FSRCNNX has also scored worse than its smaller sibling, presumably for the same reason. I don't think igv trained these networks with images that had been downsampled in linear light, so that's probably part 
        of the problem.
    </p>
    <p>
        The overly-sharp shaders would probably do much better on perceptual metrics, I'll evaluate whether adding a few of them to the benchmarking script makes sense on a later date.
    </p>
    <p>
        EASU (which is FSR without RCAS) actually scores way better than FSR, and I think it's probably a good option if you're looking for an efficient shader.
    </p>
    <p>
        It's nice to see that bjin came back from the dead with gold. The new ravu variants perform much better than their previous incarnations and they're also free of the half-pixel shift problem.
    </p>
    <p>
        Ravu-lite-ar-r4 is the best luma-doubler according to the metrics, and it's probably a safe choice if you're looking for a doubler. If you're not only doubling though, ravu-zoom-ar-r3 might be a better option. You can 
        also edit their trigger conditions or use auto-profiles.lua to switch between them as needed.
    </p>
    <h3 id="fractional_upsampling">Fractional Upsampling</h3>
    <p>
        While doing these tests at 2x makes sense since we can use a box filter to downsample, most people aren't always doubling their content. Scaling "performance" at lower scaling factors, such as 1.5x or 1.33x, are usually more interesting 
        because this corresponds to 720p->1080p and 1080p->1440p, respectively. This section is supposed to better represent a real world scenario when you don't have a 4K display or don't watch comically low-resolution content.
    </p>
    <h3 id="fractional_upsampling_methodology">Fractional Upsampling Methodology</h3>
    <p>
        Unfortunately, some of my choices here are only explained in the following sections. You'll have to bear with me and trust this makes (some) sense, as the alternative would be placing the fractional upsampling section at the end of the page 
        instead of here, its most logical position.
    </p>
    <p>
      In short, the entire methodology stays the same with a few modifications:
      <ol>
        <li>Downsampling was done from 1080p to 720p using catmull_rom + <a href="https://github.com/Artoriuz/glsl-pixel-clipper">Pixel Clipper</a>.</li>
        <li>The doublers were also downsampled with catmull_rom + Pixel Clipper.</li>
        <li>I've removed Anime4K from this because this is too far removed from what the devs intended it to be used for.</li>
      </ol>
    </p>
    <h3 id="fractional_upsampling_results">Fractional Upsampling Results</h3>
    <p>
      <table>
        <tbody>
          <tr>
            <td>Shader/Filter</td>
            <td>MAE</td>
            <td>PSNR</td>
            <td>SSIM</td>
            <td>MS-SSIM</td>
            <td></td>
            <td>MAE (N)</td>
            <td>PSNR (N)</td>
            <td>SSIM (N)</td>
            <td>MS-SSIM (N)</td>
            <td></td>
            <td>Mean</td>
          </tr>
          <tr>
            <td>FSRCNNX_x2_8-0-4-1_catrom_pc</td>
            <td>2.82E-03</td>
            <td>44.0656</td>
            <td>0.9929</td>
            <td>0.9992</td>
            <td></td>
            <td>0.9946</td>
            <td>0.9702</td>
            <td>0.9894</td>
            <td>1.0000</td>
            <td></td>
            <td>0.9886</td>
          </tr>
          <tr>
            <td>FSRCNNX_x2_16-0-4-1_catrom_pc</td>
            <td>2.95E-03</td>
            <td>44.1704</td>
            <td>0.9930</td>
            <td>0.9992</td>
            <td></td>
            <td>0.9194</td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td>0.9810</td>
            <td></td>
            <td>0.9751</td>
          </tr>
          <tr>
            <td>ravu-zoom-ar-r3</td>
            <td>2.81E-03</td>
            <td>43.8118</td>
            <td>0.9924</td>
            <td>0.9991</td>
            <td></td>
            <td>1.0000</td>
            <td>0.8982</td>
            <td>0.9189</td>
            <td>0.9024</td>
            <td></td>
            <td>0.9299</td>
          </tr>
          <tr>
            <td>ravu-zoom-r3</td>
            <td>2.96E-03</td>
            <td>43.7155</td>
            <td>0.9920</td>
            <td>0.9992</td>
            <td></td>
            <td>0.9172</td>
            <td>0.8708</td>
            <td>0.8647</td>
            <td>0.9980</td>
            <td></td>
            <td>0.9126</td>
          </tr>
          <tr>
            <td>ravu-lite-r4_catrom_pc</td>
            <td>3.05E-03</td>
            <td>43.5282</td>
            <td>0.9920</td>
            <td>0.9992</td>
            <td></td>
            <td>0.8638</td>
            <td>0.8176</td>
            <td>0.8663</td>
            <td>0.9633</td>
            <td></td>
            <td>0.8777</td>
          </tr>
          <tr>
            <td>ravu-zoom-ar-r2</td>
            <td>2.89E-03</td>
            <td>43.4334</td>
            <td>0.9920</td>
            <td>0.9991</td>
            <td></td>
            <td>0.9567</td>
            <td>0.7907</td>
            <td>0.8561</td>
            <td>0.8626</td>
            <td></td>
            <td>0.8665</td>
          </tr>
          <tr>
            <td>ravu-lite-r3_catrom_pc</td>
            <td>3.10E-03</td>
            <td>43.3658</td>
            <td>0.9918</td>
            <td>0.9991</td>
            <td></td>
            <td>0.8324</td>
            <td>0.7715</td>
            <td>0.8349</td>
            <td>0.9386</td>
            <td></td>
            <td>0.8443</td>
          </tr>
          <tr>
            <td>ravu-zoom-r2</td>
            <td>3.08E-03</td>
            <td>43.1801</td>
            <td>0.9915</td>
            <td>0.9991</td>
            <td></td>
            <td>0.8459</td>
            <td>0.7187</td>
            <td>0.7818</td>
            <td>0.8936</td>
            <td></td>
            <td>0.8100</td>
          </tr>
          <tr>
            <td>ravu-lite-r2_catrom_pc</td>
            <td>3.17E-03</td>
            <td>43.0046</td>
            <td>0.9914</td>
            <td>0.9991</td>
            <td></td>
            <td>0.7926</td>
            <td>0.6689</td>
            <td>0.7780</td>
            <td>0.8828</td>
            <td></td>
            <td>0.7806</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r4_catrom_pc</td>
            <td>3.12E-03</td>
            <td>42.8731</td>
            <td>0.9916</td>
            <td>0.9989</td>
            <td></td>
            <td>0.8258</td>
            <td>0.6316</td>
            <td>0.7965</td>
            <td>0.7103</td>
            <td></td>
            <td>0.7410</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r3_catrom_pc</td>
            <td>3.14E-03</td>
            <td>42.7861</td>
            <td>0.9915</td>
            <td>0.9989</td>
            <td></td>
            <td>0.8096</td>
            <td>0.6068</td>
            <td>0.7802</td>
            <td>0.7073</td>
            <td></td>
            <td>0.7260</td>
          </tr>
          <tr>
            <td>nnedi3-nns64-win8x4_catrom_pc</td>
            <td>3.21E-03</td>
            <td>42.5336</td>
            <td>0.9913</td>
            <td>0.9989</td>
            <td></td>
            <td>0.7716</td>
            <td>0.5351</td>
            <td>0.7594</td>
            <td>0.7025</td>
            <td></td>
            <td>0.6922</td>
          </tr>
          <tr>
            <td>nnedi3-nns32-win8x4_catrom_pc</td>
            <td>3.21E-03</td>
            <td>42.5250</td>
            <td>0.9913</td>
            <td>0.9989</td>
            <td></td>
            <td>0.7688</td>
            <td>0.5327</td>
            <td>0.7542</td>
            <td>0.7022</td>
            <td></td>
            <td>0.6895</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r2_catrom_pc</td>
            <td>3.19E-03</td>
            <td>42.5039</td>
            <td>0.9911</td>
            <td>0.9989</td>
            <td></td>
            <td>0.7820</td>
            <td>0.5267</td>
            <td>0.7319</td>
            <td>0.6841</td>
            <td></td>
            <td>0.6812</td>
          </tr>
          <tr>
            <td>lanczos</td>
            <td>3.44E-03</td>
            <td>41.9800</td>
            <td>0.9902</td>
            <td>0.9989</td>
            <td></td>
            <td>0.6382</td>
            <td>0.3779</td>
            <td>0.5939</td>
            <td>0.6798</td>
            <td></td>
            <td>0.5725</td>
          </tr>
          <tr>
            <td>EASU</td>
            <td>3.28E-03</td>
            <td>41.7860</td>
            <td>0.9902</td>
            <td>0.9987</td>
            <td></td>
            <td>0.7328</td>
            <td>0.3228</td>
            <td>0.5998</td>
            <td>0.5315</td>
            <td></td>
            <td>0.5467</td>
          </tr>
          <tr>
            <td>polar_lanczos</td>
            <td>3.52E-03</td>
            <td>41.4071</td>
            <td>0.9894</td>
            <td>0.9988</td>
            <td></td>
            <td>0.5927</td>
            <td>0.2152</td>
            <td>0.4805</td>
            <td>0.5951</td>
            <td></td>
            <td>0.4709</td>
          </tr>
          <tr>
            <td>FSR</td>
            <td>4.55E-03</td>
            <td>40.6494</td>
            <td>0.9861</td>
            <td>0.9982</td>
            <td></td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td></td>
            <td>0.0000</td>
          </tr>
        </tbody>
      </table>
    </p>
    <h3 id="fractional_upsampling_commentary">Fractional Upsampling Commentary</h3>
    <p>
        Unlike in the 2x test, the new ravu variants weren't capable of dethroning FSRCNNX this time. Which may sound a bit ironic considering ravu-zoom can output to the target resolution directly while FSRCNNX can't.
    </p>
    <p>
        The numbers are all closer together at 1.5x, which shows that your choice of scaler becomes less relevant as you decrease the scaling factor.
    </p>
    <p>
        It's a bit funny to see FSR get worse here, since a lower scaling factor corresponds to a higher quality preset in AMD's terms, but I think the problem is just that the shader is too sharp. 
        EASU is on top of it again but it's lower than lanczos this time. If you're going to use EASU maybe configure it to only fire up at 2x or higher.
    </p>
    <p>
        In my opinion using any of these shaders at 1.5x is probably unnecessary, since you can get good enough results with normal filters. 
        If you really want to use a shader though, I'd probably stick to ravu-zoom since it can output to the target resolution directly.
    </p>
    <h3 id="chroma_shaders">Chroma Shaders</h3>
    <p>
        Using shaders to upsample chroma is an old meme, as igv ported Shiandow's KrigBilateral to mpv years ago. KrigBilateral implements kringing interpolation, which is commonly used in geostatistics.
        You can read more about it <a href="https://en.wikipedia.org/wiki/Kriging">here</a>.
    </p>
    <p>
        There's a different technique, usually called Joint Bilateral, that simply uses luma as an extra weighting factor. In short, chromatic information from pixels with similar luminosities is preferred. <a href="">I've written a shader that 
        implements this idea</a> mostly to learn GLSL, but it ended up being quite useful as it's much faster than KrigBilateral while still keeping a nice lead over classic methods sometimes (depends on content).
    </p>
    <p>
        I've actually also written <a href="https://github.com/Artoriuz/glsl-chroma-from-luma-prediction">another meme shader</a> for this, basically taking inspiration from <a href="https://arxiv.org/abs/1711.03951">this paper</a>. In short, Chroma from 
        Luma prediction is a technique that applies linear regression to map missing chromaticities based on the known luminosities. This doesn't always work, and it's generally very unstable, but the shader employs a few tricks to make the artifacts 
        less noticeable. In theory, kriging should be better than this as it also takes pixel distance into account, but I was curious to know whether a simple linear regression would work so I ended up writing the shaders anyway.
    </p>
    <p>
        In any case, my goal here is to compare these chroma shaders against polar/orthogonal lanczos, which I'm using as reference points.
    </p>
    <h3 id="chroma_methodology">Chroma Methodology</h3>
    <p>
        This test is a little different and it requires a slightly more elaborate process. The first problem with this is that, with real video content, we rarely get a 4:4:4 copy. 
        This means that we generally don't have a reference point to work with, so we have to create one on our own.
    </p>
    <p>
        I've semi-arbitrarily decided to use a downsampled screenshot from a random One Piece fanart:
    </p>
    <p>
        <img src="./images/mpv_upscaling/chroma/uta.jpg" alt="chroma_reference" class="center" width="418" height="540">
    </p>
    <p>
        Two versions of the image were created using FFmpeg:
    </p>
    <code>ffmpeg -i original.png -pix_fmt yuv444p10le -c:v libx265 -preset placebo -x265-params lossless=1 444.mp4</code>
    <br>
    <code>ffmpeg -i original.png -pix_fmt yuv420p10le -c:v libx265 -preset placebo -x265-params lossless=1 420.mp4</code>
    <p>
        The idea here was creating (nearly) lossless variants with and without chroma subsampling.
    </p>
    <p>
        The "reference" image was obtained by screenshotting "444.mp4" on mpv.
    </p>
    <p>
        The images under test were obtained by screenshotting "420.mp4" on mpv using the various chroma resampling filters/shaders.
    </p>
    <p>
        mpv options remains the same with the exception that we don't need <inline_code>--window-scale=2.0</inline_code> anymore, and since we're comparing chroma here, the images weren't converted to grayscale.
    </p>
    <h3 id="chroma_results">Chroma Results</h3>
    <p>
      <table>
        <tbody>
          <tr>
            <td>Shader/Filter</td>
            <td>MAE</td>
            <td>PSNR</td>
            <td>SSIM</td>
            <td>MS-SSIM</td>
            <td></td>
            <td>MAE (N)</td>
            <td>PSNR (N)</td>
            <td>SSIM (N)</td>
            <td>MS-SSIM (N)</td>
            <td></td>
            <td>Mean</td>
          </tr>
          <tr>
            <td>cfl</td>
            <td>1.13E-03</td>
            <td>48.4257</td>
            <td>0.9965</td>
            <td>0.9997</td>
            <td></td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td></td>
            <td>1.0000</td>
          </tr>
          <tr>
            <td>cfl12</td>
            <td>1.16E-03</td>
            <td>48.2625</td>
            <td>0.9964</td>
            <td>0.9997</td>
            <td></td>
            <td>0.8934</td>
            <td>0.9383</td>
            <td>0.9495</td>
            <td>0.9362</td>
            <td></td>
            <td>0.9293</td>
          </tr>
          <tr>
            <td>krigbilateral</td>
            <td>1.14E-03</td>
            <td>48.2730</td>
            <td>0.9962</td>
            <td>0.9997</td>
            <td></td>
            <td>0.9379</td>
            <td>0.9422</td>
            <td>0.8303</td>
            <td>0.8049</td>
            <td></td>
            <td>0.8788</td>
          </tr>
          <tr>
            <td>cfl4</td>
            <td>1.14E-03</td>
            <td>47.8318</td>
            <td>0.9963</td>
            <td>0.9997</td>
            <td></td>
            <td>0.9424</td>
            <td>0.7753</td>
            <td>0.8858</td>
            <td>0.8606</td>
            <td></td>
            <td>0.8660</td>
          </tr>
          <tr>
            <td>lanczos</td>
            <td>1.20E-03</td>
            <td>47.1447</td>
            <td>0.9956</td>
            <td>0.9996</td>
            <td></td>
            <td>0.7103</td>
            <td>0.5153</td>
            <td>0.5315</td>
            <td>0.6807</td>
            <td></td>
            <td>0.6095</td>
          </tr>
          <tr>
            <td>polar_lanczossharp</td>
            <td>1.23E-03</td>
            <td>46.9580</td>
            <td>0.9954</td>
            <td>0.9996</td>
            <td></td>
            <td>0.6011</td>
            <td>0.4447</td>
            <td>0.4587</td>
            <td>0.5987</td>
            <td></td>
            <td>0.5258</td>
          </tr>
          <tr>
            <td>jointbilateral</td>
            <td>1.26E-03</td>
            <td>46.9536</td>
            <td>0.9953</td>
            <td>0.9996</td>
            <td></td>
            <td>0.4935</td>
            <td>0.4430</td>
            <td>0.4120</td>
            <td>0.5006</td>
            <td></td>
            <td>0.4623</td>
          </tr>
          <tr>
            <td>fastbilateral</td>
            <td>1.26E-03</td>
            <td>46.8378</td>
            <td>0.9953</td>
            <td>0.9996</td>
            <td></td>
            <td>0.4646</td>
            <td>0.3992</td>
            <td>0.4154</td>
            <td>0.3870</td>
            <td></td>
            <td>0.4165</td>
          </tr>
          <tr>
            <td>bilinear</td>
            <td>1.38E-03</td>
            <td>45.7827</td>
            <td>0.9945</td>
            <td>0.9995</td>
            <td></td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td></td>
            <td>0.0000</td>
          </tr>
        </tbody>
      </table>
    </p>
    <h3 id="chroma_commentary">Chroma Commentary</h3>
    <p>
        Assuming the methodology makes sense, there's little reason to use chroma shaders when it comes to anime content. I believe the lack of high-frequency components is severely hindering how effective they can be, 
        and as it turns out even normal filters like lanczos end up being good enough. Keep in mind this is a very detailed fanart, actual anime frames would make these differences even smaller.
    </p>
    <p>
        If you really want to use a chroma shader you should probably stick to KrigBilateral or CfL Prediction. Krig is an older and more tested shader, so you know what to expect. CfL looks sharper and produces better numbers but is new 
        and experimental, so there might be some issues to iron out. Overall they look very similar and the difference is mostly negligible in practice.
    </p>
    <h3 id="antiring">Antiring</h3>
    <p>
        Antiringing solutions is a topic that I hadn't covered in the previous iteration of this page, but now that we have more than a single option we can also compare them.
    </p>
    <p>
        In short, antiringing filters attempt to remove overshoots generated by sharp resampling filters when they meet a sharp intensity delta. 
        What is commonly referred to as ringing is simply consequential to the filter's impulse response.
    </p>
    <p>
        The following image shows this very well:
    </p>
    <p>
        <img src="./images/mpv_upscaling/antiring/ar_comparison.png" alt="ar_comparison" class="center" width="900" height="300">
    </p>
    <p>
        The negative weights in the filter are there for it to be able to quickly respond to high-frequency transitions, but it makes the filter overshoot a little bit before reaching its final destination. The "intensity" of the ringing is 
        directly related to the magnitude of the secondary lobes. The second lobe, which is almost always negative, is responsible for the overshooting in can see in this example, but filters with more lobes ring once per lobe, and the ringing can 
        be "positive" as well (within the range set by the original pixels) with positive lobes. The "length" of the rings is directly related to the length of the lobes, which is why filters like polar lanczos have "longer" rings (the zero crossings 
        don't fall exactly at the integers, but rather slightly after them).
    </p>
    <h3 id="antiring_methodology">Antiring Methodology</h3>
    <p>
        The methodology here almost is equal to the one used for upsampling, with the only difference being that we have to include <inline_code>--scale-antiring</inline_code> to use mpv's (or libplacebo's) native AR solution. We also don't have to convert to grayscale 
        this time since the shaders support RGB images just fine.
    </p>
    <p>
        AR is only really necessary when you're using sharp filters, it makes no sense alongside blurry filters because blurry filters don't ring hard enough for it to be noticeable. Polar lanczos is a relatively blurry filter, and it's probably not 
        the best candidate to test this with, however, it's also the most popular polar choice so using something else probably wouldn't be very useful to a lot of people... There are a few sharp memes that are worth trying with AR though if you feel adventurous, 
        but enerally speaking I think orthogonal lanczos and polar lanczos are pretty balanced.
    </p>
    <p>
        It's also worth mentioning that mpv uses different AR techniques for orthogonal and polar filters, but I'll name them both "_ar" for simplicity.
    </p>
    <p>
        I'm including <a href="https://github.com/Artoriuz/glsl-pixel-clipper">my AR shaders</a> in this comparison because I think they're very good at keeping everything but the overshoots intact, which does create some weird artifacts with sharp transitions sometimes, 
        specially if you use them at ludicrous scaling factors, but the output is generally clean enough on real content.
    </p>
    <h3 id="antiring_results">Antiring Results</h3>
    <p>
      <table>
        <tbody>
          <tr>
            <td>Filter</td>
            <td>MAE</td>
            <td>PSNR</td>
            <td>SSIM</td>
            <td>MS-SSIM</td>
            <td></td>
            <td>MAE (N)</td>
            <td>PSNR (N)</td>
            <td>SSIM (N)</td>
            <td>MS-SSIM (N)</td>
            <td></td>
            <td>Mean</td>
          </tr>
          <tr>
            <td>lanczos_pc4_100</td>
            <td>4.55E-03</td>
            <td>38.4763</td>
            <td>0.9831</td>
            <td>0.9985</td>
            <td></td>
            <td>1.0000</td>
            <td>0.9818</td>
            <td>1.0000</td>
            <td>0.7774</td>
            <td></td>
            <td>0.9398</td>
          </tr>
          <tr>
            <td>lanczos_pc4_75</td>
            <td>4.58E-03</td>
            <td>38.4828</td>
            <td>0.9830</td>
            <td>0.9985</td>
            <td></td>
            <td>0.9376</td>
            <td>0.9934</td>
            <td>0.9676</td>
            <td>0.8592</td>
            <td></td>
            <td>0.9395</td>
          </tr>
          <tr>
            <td>lanczos_pc4_50</td>
            <td>4.65E-03</td>
            <td>38.4633</td>
            <td>0.9827</td>
            <td>0.9986</td>
            <td></td>
            <td>0.7928</td>
            <td>0.9584</td>
            <td>0.8655</td>
            <td>0.9314</td>
            <td></td>
            <td>0.8870</td>
          </tr>
          <tr>
            <td>lanczos_pc12_100</td>
            <td>4.64E-03</td>
            <td>38.4865</td>
            <td>0.9827</td>
            <td>0.9985</td>
            <td></td>
            <td>0.8127</td>
            <td>1.0000</td>
            <td>0.8646</td>
            <td>0.8572</td>
            <td></td>
            <td>0.8837</td>
          </tr>
          <tr>
            <td>lanczos_pc12_75</td>
            <td>4.66E-03</td>
            <td>38.4782</td>
            <td>0.9826</td>
            <td>0.9986</td>
            <td></td>
            <td>0.7672</td>
            <td>0.9850</td>
            <td>0.8346</td>
            <td>0.9075</td>
            <td></td>
            <td>0.8736</td>
          </tr>
          <tr>
            <td>lanczos_pc12_50</td>
            <td>4.71E-03</td>
            <td>38.4522</td>
            <td>0.9824</td>
            <td>0.9986</td>
            <td></td>
            <td>0.6723</td>
            <td>0.9387</td>
            <td>0.7577</td>
            <td>0.9554</td>
            <td></td>
            <td>0.8310</td>
          </tr>
          <tr>
            <td>lanczos_ar_50</td>
            <td>4.67E-03</td>
            <td>38.3433</td>
            <td>0.9826</td>
            <td>0.9985</td>
            <td></td>
            <td>0.7602</td>
            <td>0.7442</td>
            <td>0.8129</td>
            <td>0.8172</td>
            <td></td>
            <td>0.7836</td>
          </tr>
          <tr>
            <td>lanczos_ar_75</td>
            <td>4.62E-03</td>
            <td>38.2819</td>
            <td>0.9827</td>
            <td>0.9984</td>
            <td></td>
            <td>0.8564</td>
            <td>0.6345</td>
            <td>0.8472</td>
            <td>0.6661</td>
            <td></td>
            <td>0.7511</td>
          </tr>
          <tr>
            <td>lanczos</td>
            <td>4.82E-03</td>
            <td>38.3682</td>
            <td>0.9819</td>
            <td>0.9986</td>
            <td></td>
            <td>0.4568</td>
            <td>0.7886</td>
            <td>0.5388</td>
            <td>1.0000</td>
            <td></td>
            <td>0.6961</td>
          </tr>
          <tr>
            <td>lanczos_ar_100</td>
            <td>4.61E-03</td>
            <td>38.1854</td>
            <td>0.9826</td>
            <td>0.9983</td>
            <td></td>
            <td>0.8767</td>
            <td>0.4622</td>
            <td>0.8150</td>
            <td>0.4950</td>
            <td></td>
            <td>0.6622</td>
          </tr>
          <tr>
            <td>polar_lanczos_ar_75</td>
            <td>4.73E-03</td>
            <td>38.0348</td>
            <td>0.9818</td>
            <td>0.9982</td>
            <td></td>
            <td>0.6240</td>
            <td>0.1933</td>
            <td>0.5137</td>
            <td>0.1963</td>
            <td></td>
            <td>0.3818</td>
          </tr>
          <tr>
            <td>polar_lanczos_pc4_100</td>
            <td>4.76E-03</td>
            <td>38.0367</td>
            <td>0.9817</td>
            <td>0.9982</td>
            <td></td>
            <td>0.5667</td>
            <td>0.1966</td>
            <td>0.4694</td>
            <td>0.2895</td>
            <td></td>
            <td>0.3806</td>
          </tr>
          <tr>
            <td>polar_lanczos_pc4_75</td>
            <td>4.80E-03</td>
            <td>38.0387</td>
            <td>0.9816</td>
            <td>0.9983</td>
            <td></td>
            <td>0.4970</td>
            <td>0.2003</td>
            <td>0.4300</td>
            <td>0.3567</td>
            <td></td>
            <td>0.3710</td>
          </tr>
          <tr>
            <td>polar_lanczos_ar_50</td>
            <td>4.81E-03</td>
            <td>38.0317</td>
            <td>0.9816</td>
            <td>0.9983</td>
            <td></td>
            <td>0.4771</td>
            <td>0.1878</td>
            <td>0.4312</td>
            <td>0.3372</td>
            <td></td>
            <td>0.3583</td>
          </tr>
          <tr>
            <td>polar_lanczos_ar_100</td>
            <td>4.73E-03</td>
            <td>38.0045</td>
            <td>0.9818</td>
            <td>0.9981</td>
            <td></td>
            <td>0.6297</td>
            <td>0.1392</td>
            <td>0.5035</td>
            <td>0.0000</td>
            <td></td>
            <td>0.3181</td>
          </tr>
          <tr>
            <td>polar_lanczos_pc12_100</td>
            <td>4.85E-03</td>
            <td>38.0394</td>
            <td>0.9813</td>
            <td>0.9983</td>
            <td></td>
            <td>0.3817</td>
            <td>0.2015</td>
            <td>0.3319</td>
            <td>0.3539</td>
            <td></td>
            <td>0.3173</td>
          </tr>
          <tr>
            <td>polar_lanczos_pc4_50</td>
            <td>4.87E-03</td>
            <td>38.0185</td>
            <td>0.9813</td>
            <td>0.9983</td>
            <td></td>
            <td>0.3487</td>
            <td>0.1642</td>
            <td>0.3231</td>
            <td>0.4145</td>
            <td></td>
            <td>0.3126</td>
          </tr>
          <tr>
            <td>polar_lanczos_pc12_75</td>
            <td>4.88E-03</td>
            <td>38.0308</td>
            <td>0.9812</td>
            <td>0.9983</td>
            <td></td>
            <td>0.3322</td>
            <td>0.1861</td>
            <td>0.2989</td>
            <td>0.3935</td>
            <td></td>
            <td>0.3027</td>
          </tr>
          <tr>
            <td>polar_lanczos_pc12_50</td>
            <td>4.93E-03</td>
            <td>38.0061</td>
            <td>0.9810</td>
            <td>0.9983</td>
            <td></td>
            <td>0.2309</td>
            <td>0.1421</td>
            <td>0.2164</td>
            <td>0.4286</td>
            <td></td>
            <td>0.2545</td>
          </tr>
          <tr>
            <td>polar_lanczos</td>
            <td>5.04E-03</td>
            <td>37.9266</td>
            <td>0.9804</td>
            <td>0.9983</td>
            <td></td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.4546</td>
            <td></td>
            <td>0.1137</td>
          </tr>
        </tbody>
      </table>
    </p>
    <h3 id="antiring_commentary">Antiring Commentary</h3>
    <p>
        Previously, this section talked about the different strengths and weaknesses of Pixel Clipper and libplacebo's AR, but that's not really neccessary anymore. 
        Libplacebo's AR has been <a href="https://code.videolan.org/videolan/libplacebo/-/commit/7fb12078b8f0e212f1cc3f5631fb891b3a08ca1c">recently updated</a> and it looks great now. It's actually shocking 
        how similar the solutions look at 2x considering how different the mechanisms are.
    </p>
    <p>
        The only caveat is that libplacebo's AR is still a bit blurrier at similar strength, so you probably have to dial it down a little bit to preserve sharpness (0.75 seems to be a good starting point). 
    </p>
    <p>
        mpv's native AR solution for orthogonal filters shouldn't blur anything though, and I believe Pixel Clipper is only scoring higher than it because mpv applies its antiring twice, once per orthogonal pass. This means that the second pass 
        won't have access to the overshoots created by the first pass, which is theoretically a good thing but actually ends up hurting the filter's reconstruction quality. Pixel Clipper is only applied after scaling is done, so it's completely 
        oblivious to the entire scaling process. It simply clamps the HR pixels to the intensity bounds set by the surrounding LR pixels.
    </p>
    <p>
        I've personally started using Pixel Clipper with orthogonal filters recently but then again the difference isn't that big, the built-in solution works well enough.
    </p>
    <p>
        As the table shows, the improvement AR brings is extremely minor, while it's a nice to have it's also entirely skippable. I'd argue most people would never notice the difference when using "balanced" filters such as ortho/polar lanczos, 
        specially if the source is naturally noisy. Also, while ringing is obviously numerically bad, humans can sometimes even enjoy some minor ringing, as it makes things look perceptually sharper. 
    </p>
    <h3 id="downsampling_antiring">Downsampling Antiring</h3>
    <p>
        Pixel Clipper actually has a downsampling variant as well, which I believe is probably less broken than mpv's native <inline_code>--dscale-antiring</inline_code> solution for orthogonal filters. 
        Libplacebo's new polar AR has been recently enabled for downsampling as well, so we can also test that here. I'm skipping doing these tests at different strengths though, as throwing away unwanted information should be 
        easier when downsampling.
    </p>
    <p>
        The following image will be used for downsampling AR tests:
    </p>
    <img src="./images/mpv_upscaling/downsampling/highres.png" alt="yurucamp" class="center" width="960" height="540">
    <h3 id="downsampling_antiring_methodology">Downsampling Antiring Methodology</h3>
    <p>
        My current method to evaluate downsampling filters is to concede that at 0.5x linear light box is as good as it gets, since in this case we're just averaging 4 pixels together. 
        We can't use box itself for other scaling factors though, so the aim is to find a filter that produces a similar result but is also usable at any other arbitrary scaling factor.
    </p>
    <p>
        To eliminate any differences caused by how differently mpv and ImageMagick perform linear light conversion, the box reference was also obtained using mpv.
    </p>
    <p>
        The images were basically generated using the following commands:
    </p>
    <code>mpv --no-config --vo=gpu-next --no-hidpi-window-scale --window-scale=0.5 --pause=yes --screenshot-format=png --linear-downscaling --correct-downscaling --deband=no --dither-depth=no --screenshot-high-bit-depth=no --dscale=filter --glsl-shader="Pixel Clipper_downscaling.glsl" higres.png</code>
    <br><br>
    <code>mpv --no-config --vo=gpu-next --no-hidpi-window-scale --window-scale=0.5 --pause=yes --screenshot-format=png --linear-downscaling --correct-downscaling --deband=no --dither-depth=no --screenshot-high-bit-depth=no --dscale=filter --scale-antiring=1 higres.png</code>
    <p>
      Please note that you have to set <inline_code>--scale-antiring=1</inline_code> instead of <inline_code>--dscale-antiring=1</inline_code>. That's probably a bug but it is what it is.
    </p>
    <h3 id="downsampling_antiring_results">Downsampling Antiring Results</h3>
    <p>
      <table>
        <tbody>
          <tr>
            <td>Filter</td>
            <td>MAE</td>
            <td>PSNR</td>
            <td>SSIM</td>
            <td>MS-SSIM</td>
            <td></td>
            <td>MAE (N)</td>
            <td>PSNR (N)</td>
            <td>SSIM (N)</td>
            <td>MS-SSIM (N)</td>
            <td></td>
            <td>Mean</td>
          </tr>
          <tr>
            <td>lanczos_pc_100</td>
            <td>2.73E-03</td>
            <td>42.0482</td>
            <td>0.9950</td>
            <td>0.9994</td>
            <td></td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td></td>
            <td>1.0000</td>
          </tr>
          <tr>
            <td>lanczos_pc_75</td>
            <td>3.04E-03</td>
            <td>41.3289</td>
            <td>0.9945</td>
            <td>0.9994</td>
            <td></td>
            <td>0.8631</td>
            <td>0.8774</td>
            <td>0.9283</td>
            <td>0.9444</td>
            <td></td>
            <td>0.9033</td>
          </tr>
          <tr>
            <td>lanczos_pc_50</td>
            <td>3.35E-03</td>
            <td>40.1205</td>
            <td>0.9938</td>
            <td>0.9993</td>
            <td></td>
            <td>0.7272</td>
            <td>0.6716</td>
            <td>0.8200</td>
            <td>0.8176</td>
            <td></td>
            <td>0.7591</td>
          </tr>
          <tr>
            <td>polar_lanczos_ar_100</td>
            <td>3.48E-03</td>
            <td>39.8136</td>
            <td>0.9924</td>
            <td>0.9992</td>
            <td></td>
            <td>0.6681</td>
            <td>0.6193</td>
            <td>0.6168</td>
            <td>0.7199</td>
            <td></td>
            <td>0.6560</td>
          </tr>
          <tr>
            <td>polar_lanczos_pc_100</td>
            <td>3.63E-03</td>
            <td>39.6853</td>
            <td>0.9921</td>
            <td>0.9992</td>
            <td></td>
            <td>0.6014</td>
            <td>0.5974</td>
            <td>0.5750</td>
            <td>0.7178</td>
            <td></td>
            <td>0.6229</td>
          </tr>
          <tr>
            <td>polar_lanczos_ar_75</td>
            <td>3.76E-03</td>
            <td>39.3739</td>
            <td>0.9920</td>
            <td>0.9992</td>
            <td></td>
            <td>0.5451</td>
            <td>0.5444</td>
            <td>0.5596</td>
            <td>0.7189</td>
            <td></td>
            <td>0.5920</td>
          </tr>
          <tr>
            <td>polar_lanczos_pc_75</td>
            <td>4.00E-03</td>
            <td>39.1424</td>
            <td>0.9914</td>
            <td>0.9992</td>
            <td></td>
            <td>0.4375</td>
            <td>0.5049</td>
            <td>0.4839</td>
            <td>0.6504</td>
            <td></td>
            <td>0.5192</td>
          </tr>
          <tr>
            <td>polar_lanczos_ar_50</td>
            <td>4.15E-03</td>
            <td>38.4096</td>
            <td>0.9910</td>
            <td>0.9991</td>
            <td></td>
            <td>0.3725</td>
            <td>0.3801</td>
            <td>0.4261</td>
            <td>0.5802</td>
            <td></td>
            <td>0.4397</td>
          </tr>
          <tr>
            <td>lanczos</td>
            <td>3.93E-03</td>
            <td>37.7231</td>
            <td>0.9917</td>
            <td>0.9990</td>
            <td></td>
            <td>0.4672</td>
            <td>0.2631</td>
            <td>0.5215</td>
            <td>0.4190</td>
            <td></td>
            <td>0.4177</td>
          </tr>
          <tr>
            <td>polar_lanczos_pc_50</td>
            <td>4.35E-03</td>
            <td>38.2089</td>
            <td>0.9905</td>
            <td>0.9991</td>
            <td></td>
            <td>0.2840</td>
            <td>0.3459</td>
            <td>0.3520</td>
            <td>0.4952</td>
            <td></td>
            <td>0.3693</td>
          </tr>
          <tr>
            <td>polar_lanczos</td>
            <td>4.99E-03</td>
            <td>36.1789</td>
            <td>0.9881</td>
            <td>0.9987</td>
            <td></td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td></td>
            <td>0.0000</td>
          </tr>
        </tbody>
      </table>
    </p>
    <h3 id="downsampling_antiring_commentary">Downsampling Antiring Commentary</h3>
    <p>
        The first thing we can see is that AR seems to be a net-positive in general, and the score differences we see here are much larger than their upsampling counterparts.
    </p>
    <p>
        It's also good to see that libplacebo's AR seems to work even better when downsampling, as it can remove ringing without introducing any significant blur. This consolidates that there's little reason to use Pixel Clipper over 
        Libplacebo's native AR if you're using polar filters. 
    </p>
    <p>
        It's also worth mentioning that downsampling AR only makes sense when you're using a sharp filter. Blurry filters such as mitchell do not benefit nearly as much from this (since there's almost no ringing to remove), and the remark that some 
        mild ringing can be perceived as a positive thing by the human eye is also valid here. Personally I'd say you probably need some AR for anything sharper than catrom, but catrom itself is still perfectly usable without AR.
    </p>
    <h3 id="performance">Performance Benchmarks</h3>
    <p>
        Benchmarking mpv performance is a bit tricky due to a few things:
        <ol>
            <li>
                Due to the relatively cheap load, it's difficult to predict at which power state the GPU will stay at while we benchmark. To virtually increase the load, in an attempt to level the ground, 
                we can cheese mpv into outputting frames as quickly as possible, but that's not necessarily representative of a real-world scenario.
            </li>
            <li>
                Hardware, OS, drivers, display servers, etc... All of those things affect mpv performance in complex ways that are usually unpredictable, so even if my benchmarks were perfect they'd still only be relevant for those with similar systems.
            </li>
        </ol>
    </p>
    <p>
        In any case, the following numbers were produced with these mpv settings with a 720p anime episode (~24 minutes long video) on a 5600X+6600XT+Windows 11:
        <br>
        <br>
        <code>
            Measure-Command { mpv --no-config --profile=gpu-hq --vo=gpu-next --gpu-api=vulkan --audio=no --untimed=yes --video-sync=display-desync --vulkan-swap-mode=immediate --window-scale=2.0 --fullscreen=yes }
        </code>
    </p>
    <p>
      <table>
        <tbody>
          <tr>
            <td>Filter/Shader</td>
            <td>FPS</td>
            <td>Time</td>
            <td>Relative</td>
          </tr>
          <tr>
            <td>lanczos</td>
            <td>1322</td>
            <td>64.92</td>
            <td>1.0000</td>
          </tr>
          <tr>
            <td>fastbilateral</td>
            <td>1284</td>
            <td>66.83</td>
            <td>0.9714</td>
          </tr>
          <tr>
            <td>jointbilateral</td>
            <td>1262</td>
            <td>68.01</td>
            <td>0.9546</td>
          </tr>
          <tr>
            <td>cfl_4</td>
            <td>1244</td>
            <td>68.99</td>
            <td>0.9410</td>
          </tr>
          <tr>
            <td>cfl_12</td>
            <td>1219</td>
            <td>70.38</td>
            <td>0.9224</td>
          </tr>
          <tr>
            <td>cfl_16</td>
            <td>1207</td>
            <td>71.10</td>
            <td>0.9130</td>
          </tr>
          <tr>
            <td>ravu-lite-r2</td>
            <td>1197</td>
            <td>71.70</td>
            <td>0.9053</td>
          </tr>
          <tr>
            <td>EASU</td>
            <td>1188</td>
            <td>72.24</td>
            <td>0.8986</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r2</td>
            <td>1172</td>
            <td>73.23</td>
            <td>0.8865</td>
          </tr>
          <tr>
            <td>krigbilateral</td>
            <td>1167</td>
            <td>73.50</td>
            <td>0.8832</td>
          </tr>
          <tr>
            <td>cfl_mix</td>
            <td>1160</td>
            <td>73.97</td>
            <td>0.8776</td>
          </tr>
          <tr>
            <td>polar_lanczos</td>
            <td>1157</td>
            <td>74.17</td>
            <td>0.8752</td>
          </tr>
          <tr>
            <td>ravu-lite-r3</td>
            <td>1144</td>
            <td>75.02</td>
            <td>0.8654</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r3</td>
            <td>1143</td>
            <td>75.08</td>
            <td>0.8646</td>
          </tr>
          <tr>
            <td>ravu-zoom-r2</td>
            <td>1131</td>
            <td>75.85</td>
            <td>0.8559</td>
          </tr>
          <tr>
            <td>ravu-lite-r4</td>
            <td>1071</td>
            <td>80.08</td>
            <td>0.8107</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r4</td>
            <td>1069</td>
            <td>80.28</td>
            <td>0.8086</td>
          </tr>
          <tr>
            <td>ravu-zoom-ar-r2</td>
            <td>1057</td>
            <td>81.19</td>
            <td>0.7995</td>
          </tr>
          <tr>
            <td>FSR</td>
            <td>1056</td>
            <td>81.25</td>
            <td>0.7990</td>
          </tr>
          <tr>
            <td>polar_lanczos_ar</td>
            <td>986</td>
            <td>87.03</td>
            <td>0.7459</td>
          </tr>
          <tr>
            <td>ravu-zoom-r3</td>
            <td>912</td>
            <td>94.11</td>
            <td>0.6898</td>
          </tr>
          <tr>
            <td>polar_lanczos_pixelclipper</td>
            <td>863</td>
            <td>99.41</td>
            <td>0.6530</td>
          </tr>
          <tr>
            <td>ravu-zoom-ar-r3</td>
            <td>847</td>
            <td>101.25</td>
            <td>0.6411</td>
          </tr>
          <tr>
            <td>FSRCNNX_x2_8-0-4-1</td>
            <td>806</td>
            <td>106.51</td>
            <td>0.6095</td>
          </tr>
          <tr>
            <td>nnedi3-nns32-win8x4</td>
            <td>758</td>
            <td>113.17</td>
            <td>0.5736</td>
          </tr>
          <tr>
            <td>nnedi3-nns64-win8x4</td>
            <td>535</td>
            <td>160.44</td>
            <td>0.4046</td>
          </tr>
          <tr>
            <td>FSRCNNX_x2_16-0-4-1</td>
            <td>340</td>
            <td>252.58</td>
            <td>0.2570</td>
          </tr>
        </tbody>
      </table>
    </p>
    <p>
        Please keep in mind that the choice of built-in filter doesn't matter that much as the weights get stored in a LUT, so something like lanczos and spline36 (gpu-hq default) have virtually identical performance. In short, filters 
        with larger radii will obviously be slower, polar filters are slower than their orthogonal counterparts and AR obviously also makes things slower.
    </p>
    <p>
        For the shaders, the number are more or less what I expected, but it's nice to see that in the grand scheme of things these shaders don't really slow the playback down that much. Good old polar lanczos with AR is already as slow as most shaders.
    </p>
    <p>
        Still though, the conclusion here seems to be that if you're running mpv on a semi-decent computer, these shaders will never be a problem.
        Please note that you can make it go even faster with hardware decoding, but <inline_code>--d3d11-sync-interval=0</inline_code> doesn't seem to work in fullscreen, so it is what it is. 
        Until AMD fixes Vulkan hwdec in their drivers this is probably the best I can provide.
    </p>
    <p>
        CfL numbers are currently out of date, but the new shader with everything in a single pass is between the 12 tap and 16 tap variants (only marginally slower than the 12 tap variant on my laptop).
    </p>
    <h3 id="outro">Outro</h3>
    <p>
        I want to make it clear though that you shouldn't take the results as gospel. Mathematical image quality metrics do not always correlate perfectly with how humans perceive image quality, 
        and your personal preference is entirely subjective. You should take this page as what it is, a research that produces numbers, but you should not take these numbers for granted before 
        understanding what they actually mean.
    </p>
</section>
        <br>
        <br>
        <nav>
            <menu>
                <a href="../index.html">Home</a>
                <a href="#introduction">Introduction</a>
                <a href="https://github.com/Artoriuz">GitHub</a>
                <a href="https://www.linkedin.com/in/jvrchrisostomo/">LinkedIn</a>
            </menu>
        </nav>
        <br>
        <br>
</body>
</html>
