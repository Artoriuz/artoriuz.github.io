<!DOCTYPE html>
<html lang="en">

<head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135192850-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-135192850-1');
    </script>

    <title>Mathematically Evaluating mpv's Resampling Algorithms</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="./css/default.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Roboto+Slab&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <hgroup>
            <h1>
                mpv Resampling
            </h1>
            <h2>A sequel in the making</h2>
        </hgroup>
    </header>
    <nav>
        <menu>
            <a href="../index.html">Home</a>
            <a href="https://github.com/Artoriuz">GitHub</a>
            <a href="https://www.linkedin.com/in/jvrchrisostomo/">LinkedIn</a>
        </menu>
    </nav>
    <section>
        <h3 id="introduction">Introduction</h3>
        <p>
            This page is meant to be treated as a follow-up to this scaler comparison done with <a href="https://artoriuz.github.io/blog/imagemagick_resampling.html">ImageMagick</a>. I'm only going to talk about niche topics here,
            so just refer to that other page if you only want to read about scalers.
        </p>
        <h3 id="upsampling_shaders">Upsampling Shaders</h3>
        <p>
            The mpv community has written several <s>meme</s> shaders you can use to upsample video in real time, and the rationale is that they can potentially achieve higher quality than the built-in methods. I still do not have a good way of
            automating mpv tests and therefore I'll have to stick to a single test image, which is still going to be violet.png just because I'm familiarised with it. If this is your first time reading these posts, this is what violet.png looks like:
        </p>
        <p>
            <img src="./images/mpv_upscaling/upsampling/violet.png" alt="Violet" class="center" width="960" height="540">
        </p>
        <p>
            The small number of samples under test makes this very unscientific, but it is what it is.
        </p>
        <h3 id="upsampling_methodology">Upsampling Methodology</h3>
        <p>
            The following shaders were "benchmarked":
            <ol>
              <li><a href="https://github.com/Artoriuz/ArtCNN">ArtCNN</a></li>
              <li><a href="https://github.com/bjin/mpv-prescalers">RAVU</a></li>
              <li><a href="https://github.com/bjin/mpv-prescalers">NNEDI3</a></li>
              <li><a href="https://github.com/igv/FSRCNN-TensorFlow">FSRCNNX</a></li>
              <li><a href="https://github.com/bloc97/Anime4K">Anime4K</a></li>
              <li><a href="https://gist.github.com/agyild/82219c545228d70c5604f865ce0b0ce5">FSR</a></li>
            </ol>
            I've also added orthogonal lanczos and polar lanczossharp to the mix just to have a reference point, but feel free to send me any other shaders you would like to get scored.
            For Anime4K I'm using the <a href="https://github.com/bloc97/Anime4K/blob/815b122284304e6e1e244a8cf6a160eeaa07040c/GLSL_Instructions.md">"C" mode</a> which is defined as <inline_code>Upscale_Denoise -> Upscale</inline_code>.
        </p>
        <p>
            The test image is downsampled with:
        </p>
        <code>magick convert violet.png -colorspace rgb -filter box -resize 50% -colorspace srgb downscaled.png</code>
        <p>
            It is then converted to grayscale with:
        </p>
        <code>magick convert downscaled.png -colorspace gray downscaled.png</code>
        <p>
            The original image is also converted to grayscale using the same command to create the reference:
        </p>
        <code>magick convert violet.png -colorspace gray reference.png</code>
        <p>
            We need to convert them to grayscale because some of these shaders do not have RGB support.
        </p>
        <p>
            The images were then upsampled back with:
        </p>
        <code>mpv --no-config --vo=gpu-next --no-hidpi-window-scale --window-scale=2.0 --pause=yes --screenshot-format=png --sigmoid-upscaling --deband=no --dither-depth=no --screenshot-high-bit-depth=no --glsl-shader="path/to/meme/shader" downscaled.png</code>
        <h3 id="upsampling_results">Upsampling Results</h3>
        <p>
          <table>
            <tbody>
              <tr>
                <td>Shader/Filter</td>
                <td>MAE</td>
                <td>PSNR</td>
                <td>SSIM</td>
                <td>MS-SSIM</td>
                <td></td>
                <td>MAE (N)</td>
                <td>PSNR (N)</td>
                <td>SSIM (N)</td>
                <td>MS-SSIM (N)</td>
                <td></td>
                <td>Mean</td>
              </tr>
              <tr>
                <td>ArtCNN_C4F16</td>
                <td>2.90E-03</td>
                <td>43.7904</td>
                <td>0.9917</td>
                <td>0.9992</td>
                <td></td>
                <td>1.0000</td>
                <td>1.0000</td>
                <td>1.0000</td>
                <td>1.0000</td>
                <td></td>
                <td>1.0000</td>
              </tr>
              <tr>
                <td>ArtCNN_C4F8</td>
                <td>3.07E-03</td>
                <td>43.1650</td>
                <td>0.9908</td>
                <td>0.9992</td>
                <td></td>
                <td>0.9482</td>
                <td>0.9275</td>
                <td>0.9492</td>
                <td>0.9983</td>
                <td></td>
                <td>0.9558</td>
              </tr>
              <tr>
                <td>ravu-lite-ar-r4</td>
                <td>3.46E-03</td>
                <td>41.3618</td>
                <td>0.9887</td>
                <td>0.9987</td>
                <td></td>
                <td>0.8316</td>
                <td>0.7184</td>
                <td>0.8354</td>
                <td>0.8819</td>
                <td></td>
                <td>0.8168</td>
              </tr>
              <tr>
                <td>ravu-zoom-ar-r3</td>
                <td>3.44E-03</td>
                <td>41.2143</td>
                <td>0.9889</td>
                <td>0.9987</td>
                <td></td>
                <td>0.8378</td>
                <td>0.7013</td>
                <td>0.8458</td>
                <td>0.8818</td>
                <td></td>
                <td>0.8167</td>
              </tr>
              <tr>
                <td>ravu-lite-ar-r3</td>
                <td>3.55E-03</td>
                <td>41.0825</td>
                <td>0.9883</td>
                <td>0.9988</td>
                <td></td>
                <td>0.8055</td>
                <td>0.6860</td>
                <td>0.8097</td>
                <td>0.8890</td>
                <td></td>
                <td>0.7976</td>
              </tr>
              <tr>
                <td>ravu-lite-r4</td>
                <td>3.72E-03</td>
                <td>41.2500</td>
                <td>0.9876</td>
                <td>0.9989</td>
                <td></td>
                <td>0.7543</td>
                <td>0.7054</td>
                <td>0.7716</td>
                <td>0.9280</td>
                <td></td>
                <td>0.7898</td>
              </tr>
              <tr>
                <td>ravu-zoom-r3</td>
                <td>3.79E-03</td>
                <td>41.0404</td>
                <td>0.9872</td>
                <td>0.9990</td>
                <td></td>
                <td>0.7325</td>
                <td>0.6811</td>
                <td>0.7464</td>
                <td>0.9412</td>
                <td></td>
                <td>0.7753</td>
              </tr>
              <tr>
                <td>FSRCNNX_x2_8-0-4-1</td>
                <td>3.77E-03</td>
                <td>40.9503</td>
                <td>0.9882</td>
                <td>0.9987</td>
                <td></td>
                <td>0.7375</td>
                <td>0.6707</td>
                <td>0.8077</td>
                <td>0.8632</td>
                <td></td>
                <td>0.7698</td>
              </tr>
              <tr>
                <td>ravu-zoom-ar-r2</td>
                <td>3.63E-03</td>
                <td>40.5841</td>
                <td>0.9877</td>
                <td>0.9987</td>
                <td></td>
                <td>0.7787</td>
                <td>0.6282</td>
                <td>0.7778</td>
                <td>0.8719</td>
                <td></td>
                <td>0.7642</td>
              </tr>
              <tr>
                <td>ravu-lite-r3</td>
                <td>3.81E-03</td>
                <td>40.9251</td>
                <td>0.9870</td>
                <td>0.9989</td>
                <td></td>
                <td>0.7246</td>
                <td>0.6677</td>
                <td>0.7372</td>
                <td>0.9210</td>
                <td></td>
                <td>0.7626</td>
              </tr>
              <tr>
                <td>ravu-lite-ar-r2</td>
                <td>3.73E-03</td>
                <td>40.2182</td>
                <td>0.9872</td>
                <td>0.9988</td>
                <td></td>
                <td>0.7500</td>
                <td>0.5858</td>
                <td>0.7500</td>
                <td>0.8953</td>
                <td></td>
                <td>0.7453</td>
              </tr>
              <tr>
                <td>ravu-zoom-r2</td>
                <td>3.94E-03</td>
                <td>40.4724</td>
                <td>0.9866</td>
                <td>0.9989</td>
                <td></td>
                <td>0.6864</td>
                <td>0.6152</td>
                <td>0.7132</td>
                <td>0.9183</td>
                <td></td>
                <td>0.7333</td>
              </tr>
              <tr>
                <td>ravu-lite-r2</td>
                <td>4.03E-03</td>
                <td>40.0375</td>
                <td>0.9856</td>
                <td>0.9988</td>
                <td></td>
                <td>0.6596</td>
                <td>0.5648</td>
                <td>0.6581</td>
                <td>0.9059</td>
                <td></td>
                <td>0.6971</td>
              </tr>
              <tr>
                <td>FSRCNNX_x2_16-0-4-1</td>
                <td>4.03E-03</td>
                <td>39.9168</td>
                <td>0.9873</td>
                <td>0.9984</td>
                <td></td>
                <td>0.6589</td>
                <td>0.5508</td>
                <td>0.7571</td>
                <td>0.7980</td>
                <td></td>
                <td>0.6912</td>
              </tr>
              <tr>
                <td>lanczos</td>
                <td>4.67E-03</td>
                <td>38.6816</td>
                <td>0.9826</td>
                <td>0.9984</td>
                <td></td>
                <td>0.4663</td>
                <td>0.4076</td>
                <td>0.4901</td>
                <td>0.7868</td>
                <td></td>
                <td>0.5377</td>
              </tr>
              <tr>
                <td>nnedi3-nns64-win8x4</td>
                <td>4.41E-03</td>
                <td>38.6337</td>
                <td>0.9839</td>
                <td>0.9973</td>
                <td></td>
                <td>0.5459</td>
                <td>0.4020</td>
                <td>0.5655</td>
                <td>0.5102</td>
                <td></td>
                <td>0.5059</td>
              </tr>
              <tr>
                <td>polar_lanczossharp</td>
                <td>4.79E-03</td>
                <td>38.3683</td>
                <td>0.9818</td>
                <td>0.9982</td>
                <td></td>
                <td>0.4307</td>
                <td>0.3713</td>
                <td>0.4471</td>
                <td>0.7271</td>
                <td></td>
                <td>0.4940</td>
              </tr>
              <tr>
                <td>nnedi3-nns32-win8x4</td>
                <td>4.46E-03</td>
                <td>38.5214</td>
                <td>0.9835</td>
                <td>0.9973</td>
                <td></td>
                <td>0.5313</td>
                <td>0.3890</td>
                <td>0.5437</td>
                <td>0.5020</td>
                <td></td>
                <td>0.4915</td>
              </tr>
              <tr>
                <td>FSR</td>
                <td>5.10E-03</td>
                <td>39.0008</td>
                <td>0.9817</td>
                <td>0.9981</td>
                <td></td>
                <td>0.3382</td>
                <td>0.4446</td>
                <td>0.4422</td>
                <td>0.7135</td>
                <td></td>
                <td>0.4846</td>
              </tr>
              <tr>
                <td>Anime4K_C_S</td>
                <td>5.60E-03</td>
                <td>36.3773</td>
                <td>0.9783</td>
                <td>0.9972</td>
                <td></td>
                <td>0.1879</td>
                <td>0.1404</td>
                <td>0.2469</td>
                <td>0.4765</td>
                <td></td>
                <td>0.2629</td>
              </tr>
              <tr>
                <td>Anime4K_C_L</td>
                <td>5.83E-03</td>
                <td>35.9398</td>
                <td>0.9767</td>
                <td>0.9968</td>
                <td></td>
                <td>0.1188</td>
                <td>0.0896</td>
                <td>0.1588</td>
                <td>0.3789</td>
                <td></td>
                <td>0.1865</td>
              </tr>
              <tr>
                <td>Anime4K_C_VL</td>
                <td>5.94E-03</td>
                <td>35.6782</td>
                <td>0.9766</td>
                <td>0.9963</td>
                <td></td>
                <td>0.0850</td>
                <td>0.0593</td>
                <td>0.1538</td>
                <td>0.2450</td>
                <td></td>
                <td>0.1358</td>
              </tr>
              <tr>
                <td>Anime4K_C_M</td>
                <td>6.23E-03</td>
                <td>35.3010</td>
                <td>0.9744</td>
                <td>0.9962</td>
                <td></td>
                <td>0.0000</td>
                <td>0.0156</td>
                <td>0.0317</td>
                <td>0.2267</td>
                <td></td>
                <td>0.0685</td>
              </tr>
              <tr>
                <td>Anime4K_C_UL</td>
                <td>6.15E-03</td>
                <td>35.1667</td>
                <td>0.9750</td>
                <td>0.9959</td>
                <td></td>
                <td>0.0237</td>
                <td>0.0000</td>
                <td>0.0657</td>
                <td>0.1405</td>
                <td></td>
                <td>0.0575</td>
              </tr>
              <tr>
                <td>bilinear</td>
                <td>5.78E-03</td>
                <td>35.9907</td>
                <td>0.9739</td>
                <td>0.9954</td>
                <td></td>
                <td>0.1328</td>
                <td>0.0956</td>
                <td>0.0000</td>
                <td>0.0000</td>
                <td></td>
                <td>0.0571</td>
              </tr>
            </tbody>
          </table>
        </p>
    <h3 id="upsampling_commentary">Upsampling Commentary</h3>
    <p>
        The funniest thing about these results is that, according to distortion metrics, Anime4K is actually worse at "recreating the ground truth" than simple resampling filters.
        The problem seems to be that the shader is too sharp, it does not only ring but also makes the lines thinner. This isn't necessarily bad depending on how blurry your source is, but my test image here isn't
        blurry at all.
    </p>
    <p>
        The slower variant of FSRCNNX has also scored worse than its smaller sibling, presumably for the same reason. I don't think igv trained these networks with images that had been downsampled in linear light, so that's probably part
        of the problem.
    </p>
    <p>
        The overly-sharp shaders would probably do much better on perceptual metrics, I'll evaluate whether adding a few of them to the benchmarking script makes sense on a later date.
    </p>
    <p>
        It's nice to see that bjin came back from the dead with gold. The new ravu variants perform much better than their previous incarnations and they're also free of the half-pixel shift problem.
    </p>
    <p>
        ArtCNN seems to have a comfortable lead on top of everything else, which probably comes from training it with the Manga109 dataset downsampled in linear light. I'm also employing a simpler loss function (MAE),
        which might converge better than what FSCRNNX is using. This is probably what you should use if your hardware can handle it and you don't mind the extra heat.
    </p>
    <h3 id="fractional_upsampling">Fractional Upsampling</h3>
    <p>
        While doing these tests at 2x makes sense since we can use a box filter to downsample, most people aren't always doubling their content. Scaling "performance" at lower scaling factors, such as 1.5x or 1.33x, are usually more interesting
        because this corresponds to 720p->1080p and 1080p->1440p, respectively. This section is supposed to better represent a real world scenario when you don't have a 4K display or don't watch comically low-resolution content.
    </p>
    <h3 id="fractional_upsampling_methodology">Fractional Upsampling Methodology</h3>
    <p>
      In short, the entire methodology stays the same with a few modifications:
      <ol>
        <li>Downsampling was done from 1080p to 720p with catrom+PC to create the input image.</li>
        <li>The doublers were downsampled with catrom (without PC or any other form of AR) to reach the 1.5x scaling factor.</li>
        <li>I've removed Anime4K from this because this is too far removed from what the devs intended it to be used for.</li>
      </ol>
    </p>
    <h3 id="fractional_upsampling_results">Fractional Upsampling Results</h3>
    <p>
      <table>
        <tbody>
          <tr>
            <td>Shader/Filter</td>
            <td>MAE</td>
            <td>PSNR</td>
            <td>SSIM</td>
            <td>MS-SSIM</td>
            <td></td>
            <td>MAE (N)</td>
            <td>PSNR (N)</td>
            <td>SSIM (N)</td>
            <td>MS-SSIM (N)</td>
            <td></td>
            <td>Mean</td>
          </tr>
          <tr>
            <td>ArtCNN_C4F16</td>
            <td>2.84E-03</td>
            <td>44.5102</td>
            <td>0.9929</td>
            <td>0.9992</td>
            <td></td>
            <td>0.9825</td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td></td>
            <td>0.9956</td>
          </tr>
          <tr>
            <td>ArtCNN_C4F8</td>
            <td>2.80E-03</td>
            <td>44.4833</td>
            <td>0.9927</td>
            <td>0.9992</td>
            <td></td>
            <td>1.0000</td>
            <td>0.9953</td>
            <td>0.9825</td>
            <td>0.9949</td>
            <td></td>
            <td>0.9932</td>
          </tr>
          <tr>
            <td>FSRCNNX_x2_8-0-4-1</td>
            <td>2.87E-03</td>
            <td>43.7704</td>
            <td>0.9927</td>
            <td>0.9992</td>
            <td></td>
            <td>0.9666</td>
            <td>0.8713</td>
            <td>0.9758</td>
            <td>0.9716</td>
            <td></td>
            <td>0.9463</td>
          </tr>
          <tr>
            <td>FSRCNNX_x2_16-0-4-1</td>
            <td>2.98E-03</td>
            <td>43.8938</td>
            <td>0.9928</td>
            <td>0.9992</td>
            <td></td>
            <td>0.9179</td>
            <td>0.8928</td>
            <td>0.9879</td>
            <td>0.9664</td>
            <td></td>
            <td>0.9412</td>
          </tr>
          <tr>
            <td>ravu-zoom-ar-r3</td>
            <td>2.88E-03</td>
            <td>43.8869</td>
            <td>0.9924</td>
            <td>0.9991</td>
            <td></td>
            <td>0.9658</td>
            <td>0.8916</td>
            <td>0.9451</td>
            <td>0.9241</td>
            <td></td>
            <td>0.9316</td>
          </tr>
          <tr>
            <td>ravu-zoom-r3</td>
            <td>3.09E-03</td>
            <td>43.5967</td>
            <td>0.9918</td>
            <td>0.9991</td>
            <td></td>
            <td>0.8680</td>
            <td>0.8411</td>
            <td>0.8691</td>
            <td>0.9465</td>
            <td></td>
            <td>0.8812</td>
          </tr>
          <tr>
            <td>ravu-zoom-ar-r2</td>
            <td>2.97E-03</td>
            <td>43.3608</td>
            <td>0.9918</td>
            <td>0.9990</td>
            <td></td>
            <td>0.9229</td>
            <td>0.8001</td>
            <td>0.8729</td>
            <td>0.8850</td>
            <td></td>
            <td>0.8702</td>
          </tr>
          <tr>
            <td>ravu-lite-r4</td>
            <td>3.12E-03</td>
            <td>43.2904</td>
            <td>0.9917</td>
            <td>0.9991</td>
            <td></td>
            <td>0.8561</td>
            <td>0.7878</td>
            <td>0.8568</td>
            <td>0.9369</td>
            <td></td>
            <td>0.8594</td>
          </tr>
          <tr>
            <td>ravu-lite-r3</td>
            <td>3.17E-03</td>
            <td>43.1456</td>
            <td>0.9915</td>
            <td>0.9991</td>
            <td></td>
            <td>0.8338</td>
            <td>0.7626</td>
            <td>0.8313</td>
            <td>0.9243</td>
            <td></td>
            <td>0.8380</td>
          </tr>
          <tr>
            <td>ravu-zoom-r2</td>
            <td>3.19E-03</td>
            <td>43.0888</td>
            <td>0.9913</td>
            <td>0.9990</td>
            <td></td>
            <td>0.8224</td>
            <td>0.7528</td>
            <td>0.8044</td>
            <td>0.8978</td>
            <td></td>
            <td>0.8194</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r4</td>
            <td>3.11E-03</td>
            <td>42.8698</td>
            <td>0.9915</td>
            <td>0.9989</td>
            <td></td>
            <td>0.8588</td>
            <td>0.7147</td>
            <td>0.8297</td>
            <td>0.8379</td>
            <td></td>
            <td>0.8103</td>
          </tr>
          <tr>
            <td>ravu-lite-r2</td>
            <td>3.23E-03</td>
            <td>42.8392</td>
            <td>0.9912</td>
            <td>0.9990</td>
            <td></td>
            <td>0.8081</td>
            <td>0.7094</td>
            <td>0.7886</td>
            <td>0.8976</td>
            <td></td>
            <td>0.8009</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r3</td>
            <td>3.14E-03</td>
            <td>42.7837</td>
            <td>0.9914</td>
            <td>0.9989</td>
            <td></td>
            <td>0.8458</td>
            <td>0.6997</td>
            <td>0.8157</td>
            <td>0.8358</td>
            <td></td>
            <td>0.7992</td>
          </tr>
          <tr>
            <td>nnedi3-nns64-win8x4</td>
            <td>3.19E-03</td>
            <td>42.5799</td>
            <td>0.9913</td>
            <td>0.9989</td>
            <td></td>
            <td>0.8252</td>
            <td>0.6642</td>
            <td>0.8041</td>
            <td>0.8337</td>
            <td></td>
            <td>0.7818</td>
          </tr>
          <tr>
            <td>nnedi3-nns32-win8x4</td>
            <td>3.19E-03</td>
            <td>42.5700</td>
            <td>0.9912</td>
            <td>0.9989</td>
            <td></td>
            <td>0.8230</td>
            <td>0.6625</td>
            <td>0.7997</td>
            <td>0.8332</td>
            <td></td>
            <td>0.7796</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r2</td>
            <td>3.19E-03</td>
            <td>42.5060</td>
            <td>0.9911</td>
            <td>0.9989</td>
            <td></td>
            <td>0.8247</td>
            <td>0.6514</td>
            <td>0.7767</td>
            <td>0.8208</td>
            <td></td>
            <td>0.7684</td>
          </tr>
          <tr>
            <td>lanczos</td>
            <td>3.46E-03</td>
            <td>41.9607</td>
            <td>0.9901</td>
            <td>0.9989</td>
            <td></td>
            <td>0.7033</td>
            <td>0.5565</td>
            <td>0.6525</td>
            <td>0.7934</td>
            <td></td>
            <td>0.6764</td>
          </tr>
          <tr>
            <td>polar_lanczossharp</td>
            <td>3.44E-03</td>
            <td>41.7621</td>
            <td>0.9898</td>
            <td>0.9988</td>
            <td></td>
            <td>0.7137</td>
            <td>0.5220</td>
            <td>0.6212</td>
            <td>0.7812</td>
            <td></td>
            <td>0.6595</td>
          </tr>
          <tr>
            <td>FSR</td>
            <td>5.02E-03</td>
            <td>40.4762</td>
            <td>0.9856</td>
            <td>0.9981</td>
            <td></td>
            <td>0.0000</td>
            <td>0.2983</td>
            <td>0.0916</td>
            <td>0.3984</td>
            <td></td>
            <td>0.1971</td>
          </tr>
          <tr>
            <td>bilinear</td>
            <td>4.33E-03</td>
            <td>38.7610</td>
            <td>0.9848</td>
            <td>0.9974</td>
            <td></td>
            <td>0.3114</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td></td>
            <td>0.0778</td>
          </tr>
        </tbody>
      </table>
    </p>
    <h3 id="fractional_upsampling_commentary">Fractional Upsampling Commentary</h3>
    <p>
        The numbers are all closer together at 1.5x, which shows that your choice of scaler becomes less relevant as you decrease the scaling factor.
    </p>
    <p>
        We can see that the CNNs are topping the chart here as well, but keep in mind that since they can only double you'll waste some resources downsampling the image back to the target resolution.
        With that in mind, it seems fair to recommend ravu-zoom here unless you really don't mind loading your GPU.
    </p>
    <h3 id="chroma_shaders">Chroma Shaders</h3>
    <p>
        Using shaders to upsample chroma is an old meme, as igv ported Shiandow's KrigBilateral to mpv years ago. KrigBilateral implements kringing interpolation, which is commonly used in geostatistics.
        You can read more about it <a href="https://en.wikipedia.org/wiki/Kriging">here</a>.
    </p>
    <p>
        Anyway... My first (not very successful) attempt at a chroma shader was jointbilateral and it pretty much implemented <a href="https://johanneskopf.de/publications/jbu/paper/FinalPaper_0185.pdf">this paper.</a>
        In short, chromatic information from pixels with similar luminosities is preferred (simply uses luma-deltas as an extra weighting factor). The inherent flaw with this idea is that the shader can't overshoot, so
        it's literally incapable of reaching some intensity levels depending on how chroma subsampling is done.
    </p>
    <p>
        My second attempt at this is what's generally known as <a href="https://github.com/Artoriuz/glsl-chroma-from-luma-prediction">"CfL"</a>, which was written taking inspiration from
        <a href="https://arxiv.org/abs/1711.03951">this paper</a>. In short, Chroma from Luma (Prediction) is a technique that applies a linear regression to map the missing chromaticities based on known luminosities.
        This is paired with a sharp spatial filter that gets dynamically mixed-in based on the local correlation between chroma and luma.
    </p>
    <h3 id="chroma_methodology">Chroma Methodology</h3>
    <p>
        This test is a little different and it requires a slightly more elaborate process. The first problem with this is that with real video content we rarely get a 4:4:4 copy, so we either have to make our own
        (downsampling luma for example) or use something else.
    </p>
    <p>
        I've semi-arbitrarily decided to use this promotional art:
    </p>
    <p>
        <img src="./images/mpv_upscaling/chroma/original.png" alt="chroma_reference" class="center" width="960" height="540">
    </p>
    <p>
        Two versions of the image were created using FFmpeg:
    </p>
    <code>ffmpeg -i original.png -pix_fmt yuv444p10le -vf libplacebo=colorspace=bt709:color_primaries=bt709:color_trc=bt709:range=tv:format=yuv444p10le -c:v libx265 -preset placebo -x265-params lossless=1 444.mp4</code>
    <br><br>
    <code>ffmpeg -i original.png -pix_fmt yuv420p10le -vf libplacebo=colorspace=bt709:color_primaries=bt709:color_trc=bt709:range=tv:format=yuv420p10le -c:v libx265 -preset placebo -x265-params lossless=1 420.mp4</code>
    <p>
        The idea here was creating (nearly) lossless variants with and without chroma subsampling.
    </p>
    <p>
        The "reference" image was obtained by screenshotting "444.mp4" on mpv.
    </p>
    <p>
        The images under test were obtained by screenshotting "420.mp4" on mpv using the various chroma resampling filters/shaders.
    </p>
    <p>
        mpv options remains the same with the exception that we don't need <inline_code>--window-scale=2.0</inline_code> anymore, and since we're comparing chroma here, the images weren't converted to grayscale.
    </p>
    <h3 id="chroma_results">Chroma Results</h3>
    <table>
      <tbody>
        <tr>
          <td>Shader/Filter</td>
          <td>MAE</td>
          <td>PSNR</td>
          <td>SSIM</td>
          <td>MS-SSIM</td>
          <td></td>
          <td>MAE (N)</td>
          <td>PSNR (N)</td>
          <td>SSIM (N)</td>
          <td>MS-SSIM (N)</td>
          <td></td>
          <td>Mean</td>
        </tr>
        <tr>
          <td>cfl</td>
          <td>4.11E-03</td>
          <td>38.1577</td>
          <td>0.9905</td>
          <td>0.9992</td>
          <td></td>
          <td>1.0000</td>
          <td>1.0000</td>
          <td>1.0000</td>
          <td>1.0000</td>
          <td></td>
          <td>1.0000</td>
        </tr>
        <tr>
          <td>cfl_lite</td>
          <td>4.18E-03</td>
          <td>37.9453</td>
          <td>0.9902</td>
          <td>0.9992</td>
          <td></td>
          <td>0.9739</td>
          <td>0.9584</td>
          <td>0.9797</td>
          <td>0.9787</td>
          <td></td>
          <td>0.9727</td>
        </tr>
        <tr>
          <td>krigbilateral</td>
          <td>4.37E-03</td>
          <td>36.7895</td>
          <td>0.9888</td>
          <td>0.9990</td>
          <td></td>
          <td>0.9006</td>
          <td>0.7323</td>
          <td>0.8842</td>
          <td>0.8299</td>
          <td></td>
          <td>0.8367</td>
        </tr>
        <tr>
          <td>fastbilateral</td>
          <td>5.05E-03</td>
          <td>35.4604</td>
          <td>0.9851</td>
          <td>0.9987</td>
          <td></td>
          <td>0.6507</td>
          <td>0.4722</td>
          <td>0.6315</td>
          <td>0.6045</td>
          <td></td>
          <td>0.5897</td>
        </tr>
        <tr>
          <td>jointbilateral</td>
          <td>5.07E-03</td>
          <td>35.4165</td>
          <td>0.9851</td>
          <td>0.9987</td>
          <td></td>
          <td>0.6420</td>
          <td>0.4636</td>
          <td>0.6368</td>
          <td>0.5700</td>
          <td></td>
          <td>0.5781</td>
        </tr>
        <tr>
          <td>lanczos</td>
          <td>5.62E-03</td>
          <td>34.8552</td>
          <td>0.9815</td>
          <td>0.9986</td>
          <td></td>
          <td>0.4389</td>
          <td>0.3537</td>
          <td>0.3932</td>
          <td>0.5475</td>
          <td></td>
          <td>0.4333</td>
        </tr>
        <tr>
          <td>polar_lanczossharp</td>
          <td>5.80E-03</td>
          <td>34.5458</td>
          <td>0.9807</td>
          <td>0.9986</td>
          <td></td>
          <td>0.3720</td>
          <td>0.2932</td>
          <td>0.3356</td>
          <td>0.4923</td>
          <td></td>
          <td>0.3733</td>
        </tr>
        <tr>
          <td>bilinear</td>
          <td>6.81E-03</td>
          <td>33.0476</td>
          <td>0.9757</td>
          <td>0.9979</td>
          <td></td>
          <td>0.0000</td>
          <td>0.0000</td>
          <td>0.0000</td>
          <td>0.0000</td>
          <td></td>
          <td>0.0000</td>
        </tr>
      </tbody>
      </table>
    <h3 id="chroma_commentary">Chroma Commentary</h3>
    <p>
        Chroma upscaling is often seen as less important since the human visual system is less sensitive to chromatic variations, but there's still something to be gained using meme shaders to upscale chroma.
    </p>
    <p>
        If we look at the numbers, CfL is the best shader on all metrics. This doesn't mean that it'll always look the best, but generally speaking when it goes bad it doesn't go as bad as the others.
    </p>
    <p>
        Krigbilateral comes right after that, this shader used to be the standard recommendation for chroma shaders for years it can look fantastic sometimes. The problem is that when it goes bad it goes really bad.
    </p>
    <p>
        You should probably skip Joint/FastBilateral unless you really can't run any of the other shaders due to performance constraints.
        These shaders are kinda hit or miss just like Krig, but since they can't overshoot at all they tend to be worse than even lanczos on scenes with a lot of high-frequency information. This is rarely the case on anime content
        though, and these shaders can reduce chroma bleeding/smearing.
    </p>
    <p>
        To conclude, if you want to use a chroma shader you should probably pick either CfL or Krig.
    </p>
    <h3 id="antiring">Antiring</h3>
    <p>
        Antiringing solutions is a topic that I hadn't covered in the previous iteration of this page, but now that we have more than a single option we can also compare them.
    </p>
    <p>
        In short, antiringing filters attempt to remove overshoots generated by sharp resampling filters when they meet a sharp intensity delta.
        What is commonly referred to as ringing is simply consequential to the filter's impulse response.
    </p>
    <p>
        The following image shows this very well:
    </p>
    <p>
        <img src="./images/mpv_upscaling/antiring/ar_comparison.png" alt="ar_comparison" class="center" width="900" height="300">
    </p>
    <p>
        The negative weights in the filter are there for it to be able to quickly respond to high-frequency transitions, but it makes the filter overshoot a little bit before reaching its final destination. The "intensity" of the ringing is
        directly related to the magnitude of the secondary lobes. The second lobe, which is almost always negative, is responsible for the overshooting in can see in this example, but filters with more lobes ring once per lobe, and the ringing can
        be "positive" as well (within the range set by the original pixels) with positive lobes. The "length" of the rings is directly related to the length of the lobes, which is why filters like polar lanczos have "longer" rings (the zero crossings
        don't fall exactly at the integers, but rather slightly after them).
    </p>
    <h3 id="antiring_methodology">Antiring Methodology</h3>
    <p>
        The methodology here almost is equal to the one used for upsampling, with the only difference being that we have to include <inline_code>--scale-antiring</inline_code> to use mpv's (or libplacebo's) native AR solution. We also don't have to convert to grayscale
        this time since the shaders support RGB images just fine.
    </p>
    <p>
        AR is only really necessary when you're using sharp filters, it makes no sense alongside blurry filters because blurry filters don't ring hard enough for it to be noticeable. There are a few sharp memes that are worth trying with AR though if you feel adventurous,
        but enerally speaking I think polar lanczossharp are pretty well balanced (a bit blurry even).
    </p>
    <p>
        I'm including <a href="https://github.com/Artoriuz/glsl-pixel-clipper">my AR shader</a> in this comparison because I think it's better at keeping everything but the overshoots intact, which does create some weird artifacts with sharp transitions sometimes,
        specially if you use it at ludicrous scaling factors, but the output is generally good enough on real content.
    </p>
    <h3 id="antiring_results">Antiring Results</h3>
    <p>
    <table>
      <tbody>
        <tr>
          <td>Filter</td>
          <td>MAE</td>
          <td>PSNR</td>
          <td>SSIM</td>
          <td>MS-SSIM</td>
          <td></td>
          <td>MAE (N)</td>
          <td>PSNR (N)</td>
          <td>SSIM (N)</td>
          <td>MS-SSIM (N)</td>
          <td></td>
          <td>Mean</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_060</td>
          <td>4.62E-03</td>
          <td>38.3812</td>
          <td>0.9826</td>
          <td>0.9984</td>
          <td></td>
          <td>0.8805</td>
          <td>0.8303</td>
          <td>0.9474</td>
          <td>0.5981</td>
          <td></td>
          <td>0.8141</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_080</td>
          <td>4.65E-03</td>
          <td>38.3944</td>
          <td>0.9825</td>
          <td>0.9984</td>
          <td></td>
          <td>0.7577</td>
          <td>1.0000</td>
          <td>0.8078</td>
          <td>0.6900</td>
          <td></td>
          <td>0.8139</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_055</td>
          <td>4.63E-03</td>
          <td>38.3829</td>
          <td>0.9826</td>
          <td>0.9984</td>
          <td></td>
          <td>0.8318</td>
          <td>0.8527</td>
          <td>0.9138</td>
          <td>0.6534</td>
          <td></td>
          <td>0.8129</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_085</td>
          <td>4.64E-03</td>
          <td>38.3931</td>
          <td>0.9825</td>
          <td>0.9984</td>
          <td></td>
          <td>0.7828</td>
          <td>0.9829</td>
          <td>0.8244</td>
          <td>0.6539</td>
          <td></td>
          <td>0.8110</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_065</td>
          <td>4.61E-03</td>
          <td>38.3782</td>
          <td>0.9827</td>
          <td>0.9983</td>
          <td></td>
          <td>0.9228</td>
          <td>0.7924</td>
          <td>0.9731</td>
          <td>0.5380</td>
          <td></td>
          <td>0.8066</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_050</td>
          <td>4.64E-03</td>
          <td>38.3834</td>
          <td>0.9826</td>
          <td>0.9984</td>
          <td></td>
          <td>0.7784</td>
          <td>0.8586</td>
          <td>0.8732</td>
          <td>0.7045</td>
          <td></td>
          <td>0.8037</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_075</td>
          <td>4.66E-03</td>
          <td>38.3939</td>
          <td>0.9825</td>
          <td>0.9984</td>
          <td></td>
          <td>0.7191</td>
          <td>0.9934</td>
          <td>0.7781</td>
          <td>0.7222</td>
          <td></td>
          <td>0.8032</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_090</td>
          <td>4.64E-03</td>
          <td>38.3904</td>
          <td>0.9825</td>
          <td>0.9984</td>
          <td></td>
          <td>0.7989</td>
          <td>0.9483</td>
          <td>0.8331</td>
          <td>0.6221</td>
          <td></td>
          <td>0.8006</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_070</td>
          <td>4.60E-03</td>
          <td>38.3741</td>
          <td>0.9827</td>
          <td>0.9983</td>
          <td></td>
          <td>0.9563</td>
          <td>0.7400</td>
          <td>0.9906</td>
          <td>0.4747</td>
          <td></td>
          <td>0.7904</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_070</td>
          <td>4.67E-03</td>
          <td>38.3934</td>
          <td>0.9824</td>
          <td>0.9984</td>
          <td></td>
          <td>0.6775</td>
          <td>0.9875</td>
          <td>0.7445</td>
          <td>0.7500</td>
          <td></td>
          <td>0.7899</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_045</td>
          <td>4.66E-03</td>
          <td>38.3826</td>
          <td>0.9825</td>
          <td>0.9984</td>
          <td></td>
          <td>0.7183</td>
          <td>0.8491</td>
          <td>0.8231</td>
          <td>0.7515</td>
          <td></td>
          <td>0.7855</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_095</td>
          <td>4.64E-03</td>
          <td>38.3850</td>
          <td>0.9825</td>
          <td>0.9984</td>
          <td></td>
          <td>0.8039</td>
          <td>0.8794</td>
          <td>0.8319</td>
          <td>0.5998</td>
          <td></td>
          <td>0.7787</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_065</td>
          <td>4.68E-03</td>
          <td>38.3921</td>
          <td>0.9824</td>
          <td>0.9984</td>
          <td></td>
          <td>0.6305</td>
          <td>0.9702</td>
          <td>0.7055</td>
          <td>0.7747</td>
          <td></td>
          <td>0.7702</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_075</td>
          <td>4.59E-03</td>
          <td>38.3685</td>
          <td>0.9827</td>
          <td>0.9983</td>
          <td></td>
          <td>0.9827</td>
          <td>0.6682</td>
          <td>1.0000</td>
          <td>0.4073</td>
          <td></td>
          <td>0.7646</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_100</td>
          <td>4.64E-03</td>
          <td>38.3808</td>
          <td>0.9825</td>
          <td>0.9984</td>
          <td></td>
          <td>0.8014</td>
          <td>0.8251</td>
          <td>0.8272</td>
          <td>0.5919</td>
          <td></td>
          <td>0.7614</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_040</td>
          <td>4.68E-03</td>
          <td>38.3803</td>
          <td>0.9824</td>
          <td>0.9984</td>
          <td></td>
          <td>0.6523</td>
          <td>0.8197</td>
          <td>0.7634</td>
          <td>0.7948</td>
          <td></td>
          <td>0.7575</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_060</td>
          <td>4.69E-03</td>
          <td>38.3898</td>
          <td>0.9823</td>
          <td>0.9984</td>
          <td></td>
          <td>0.5876</td>
          <td>0.9415</td>
          <td>0.6656</td>
          <td>0.7990</td>
          <td></td>
          <td>0.7484</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_080</td>
          <td>4.59E-03</td>
          <td>38.3615</td>
          <td>0.9827</td>
          <td>0.9983</td>
          <td></td>
          <td>0.9960</td>
          <td>0.5779</td>
          <td>0.9981</td>
          <td>0.3335</td>
          <td></td>
          <td>0.7264</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_055</td>
          <td>4.70E-03</td>
          <td>38.3878</td>
          <td>0.9823</td>
          <td>0.9984</td>
          <td></td>
          <td>0.5422</td>
          <td>0.9158</td>
          <td>0.6240</td>
          <td>0.8203</td>
          <td></td>
          <td>0.7256</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_035</td>
          <td>4.69E-03</td>
          <td>38.3765</td>
          <td>0.9824</td>
          <td>0.9984</td>
          <td></td>
          <td>0.5820</td>
          <td>0.7701</td>
          <td>0.6947</td>
          <td>0.8333</td>
          <td></td>
          <td>0.7200</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_050</td>
          <td>4.72E-03</td>
          <td>38.3835</td>
          <td>0.9822</td>
          <td>0.9984</td>
          <td></td>
          <td>0.4902</td>
          <td>0.8598</td>
          <td>0.5697</td>
          <td>0.8427</td>
          <td></td>
          <td>0.6906</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_085</td>
          <td>4.59E-03</td>
          <td>38.3533</td>
          <td>0.9827</td>
          <td>0.9983</td>
          <td></td>
          <td>1.0000</td>
          <td>0.4731</td>
          <td>0.9879</td>
          <td>0.2573</td>
          <td></td>
          <td>0.6796</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_030</td>
          <td>4.71E-03</td>
          <td>38.3716</td>
          <td>0.9823</td>
          <td>0.9984</td>
          <td></td>
          <td>0.5073</td>
          <td>0.7070</td>
          <td>0.6182</td>
          <td>0.8690</td>
          <td></td>
          <td>0.6753</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_045</td>
          <td>4.73E-03</td>
          <td>38.3806</td>
          <td>0.9822</td>
          <td>0.9984</td>
          <td></td>
          <td>0.4285</td>
          <td>0.8230</td>
          <td>0.5117</td>
          <td>0.8494</td>
          <td></td>
          <td>0.6532</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_025</td>
          <td>4.73E-03</td>
          <td>38.3656</td>
          <td>0.9822</td>
          <td>0.9984</td>
          <td></td>
          <td>0.4296</td>
          <td>0.6301</td>
          <td>0.5353</td>
          <td>0.9001</td>
          <td></td>
          <td>0.6238</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_090</td>
          <td>4.59E-03</td>
          <td>38.3439</td>
          <td>0.9827</td>
          <td>0.9982</td>
          <td></td>
          <td>0.9922</td>
          <td>0.3529</td>
          <td>0.9688</td>
          <td>0.1754</td>
          <td></td>
          <td>0.6223</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_040</td>
          <td>4.75E-03</td>
          <td>38.3763</td>
          <td>0.9821</td>
          <td>0.9984</td>
          <td></td>
          <td>0.3813</td>
          <td>0.7680</td>
          <td>0.4600</td>
          <td>0.8662</td>
          <td></td>
          <td>0.6189</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_035</td>
          <td>4.76E-03</td>
          <td>38.3720</td>
          <td>0.9821</td>
          <td>0.9984</td>
          <td></td>
          <td>0.3320</td>
          <td>0.7127</td>
          <td>0.4066</td>
          <td>0.8836</td>
          <td></td>
          <td>0.5837</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_020</td>
          <td>4.75E-03</td>
          <td>38.3581</td>
          <td>0.9821</td>
          <td>0.9985</td>
          <td></td>
          <td>0.3488</td>
          <td>0.5339</td>
          <td>0.4432</td>
          <td>0.9280</td>
          <td></td>
          <td>0.5635</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_095</td>
          <td>4.59E-03</td>
          <td>38.3329</td>
          <td>0.9826</td>
          <td>0.9982</td>
          <td></td>
          <td>0.9704</td>
          <td>0.2117</td>
          <td>0.9398</td>
          <td>0.0888</td>
          <td></td>
          <td>0.5527</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_030</td>
          <td>4.77E-03</td>
          <td>38.3667</td>
          <td>0.9820</td>
          <td>0.9984</td>
          <td></td>
          <td>0.2725</td>
          <td>0.6445</td>
          <td>0.3413</td>
          <td>0.8941</td>
          <td></td>
          <td>0.5381</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_015</td>
          <td>4.78E-03</td>
          <td>38.3496</td>
          <td>0.9820</td>
          <td>0.9985</td>
          <td></td>
          <td>0.2660</td>
          <td>0.4253</td>
          <td>0.3446</td>
          <td>0.9518</td>
          <td></td>
          <td>0.4969</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_025</td>
          <td>4.79E-03</td>
          <td>38.3606</td>
          <td>0.9819</td>
          <td>0.9984</td>
          <td></td>
          <td>0.2203</td>
          <td>0.5660</td>
          <td>0.2776</td>
          <td>0.9081</td>
          <td></td>
          <td>0.4930</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_100</td>
          <td>4.60E-03</td>
          <td>38.3206</td>
          <td>0.9826</td>
          <td>0.9982</td>
          <td></td>
          <td>0.9369</td>
          <td>0.0539</td>
          <td>0.9039</td>
          <td>0.0000</td>
          <td></td>
          <td>0.4737</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_020</td>
          <td>4.80E-03</td>
          <td>38.3541</td>
          <td>0.9819</td>
          <td>0.9985</td>
          <td></td>
          <td>0.1672</td>
          <td>0.4828</td>
          <td>0.2127</td>
          <td>0.9175</td>
          <td></td>
          <td>0.4451</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_010</td>
          <td>4.80E-03</td>
          <td>38.3398</td>
          <td>0.9819</td>
          <td>0.9985</td>
          <td></td>
          <td>0.1803</td>
          <td>0.2999</td>
          <td>0.2376</td>
          <td>0.9717</td>
          <td></td>
          <td>0.4224</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_015</td>
          <td>4.82E-03</td>
          <td>38.3473</td>
          <td>0.9818</td>
          <td>0.9985</td>
          <td></td>
          <td>0.1135</td>
          <td>0.3962</td>
          <td>0.1430</td>
          <td>0.9272</td>
          <td></td>
          <td>0.3950</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_010</td>
          <td>4.83E-03</td>
          <td>38.3407</td>
          <td>0.9817</td>
          <td>0.9985</td>
          <td></td>
          <td>0.0691</td>
          <td>0.3107</td>
          <td>0.0826</td>
          <td>0.9356</td>
          <td></td>
          <td>0.3495</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_ar_005</td>
          <td>4.82E-03</td>
          <td>38.3288</td>
          <td>0.9818</td>
          <td>0.9985</td>
          <td></td>
          <td>0.0916</td>
          <td>0.1580</td>
          <td>0.1233</td>
          <td>0.9884</td>
          <td></td>
          <td>0.3403</td>
        </tr>
        <tr>
          <td>polar_lanczossharp_pc_005</td>
          <td>4.84E-03</td>
          <td>38.3330</td>
          <td>0.9817</td>
          <td>0.9985</td>
          <td></td>
          <td>0.0240</td>
          <td>0.2130</td>
          <td>0.0178</td>
          <td>0.9423</td>
          <td></td>
          <td>0.2993</td>
        </tr>
        <tr>
          <td>polar_lanczossharp</td>
          <td>4.84E-03</td>
          <td>38.3164</td>
          <td>0.9817</td>
          <td>0.9985</td>
          <td></td>
          <td>0.0000</td>
          <td>0.0000</td>
          <td>0.0000</td>
          <td>1.0000</td>
          <td></td>
          <td>0.2500</td>
        </tr>
      </tbody>
    </table>
    </p>
    <h3 id="antiring_commentary">Antiring Commentary</h3>
    <p>
        Previously, this section talked about the different strengths and weaknesses of Pixel Clipper and libplacebo's AR, but that's not really neccessary anymore.
        Libplacebo's AR has been <a href="https://code.videolan.org/videolan/libplacebo/-/commit/7fb12078b8f0e212f1cc3f5631fb891b3a08ca1c">recently updated</a> and it looks great now. It's actually shocking
        how similar the solutions look at 2x considering how different the mechanisms are.
    </p>
    <p>
        The only caveat is that libplacebo's AR is still a bit blurrier at similar strengths, so keep that in mind.
    </p>
    <p>
        As you can see in the table above, the sweetspot for libplacebo's AR seems to be around 0.6 taking all the metrics into account. I could end the commentary here but if you pay attention you can also
        see that 0.6 isn't at the top of any of the individual metrics, but it does score above average on all of them. This is actually pretty interesting as these metrics tell us different things:
    </p>
    <p>
        If we choose to focus on MAE, the sweetspot seems to be around 0.85. MAE is very good at telling us what is numerically closer to the reference without biasing this towards any specific type of
        artifacts regardless of how humans perceive them.
    </p>
    <p>
        If you only want to know how bad the worst pixels are you can focus on PSNR instead, and in this case Pixel Clipper seems to be much better than libplacebo's AR (presumably because the latter is smoother).
        The sweetspot seems to be around 0.8 here for PC, and 0.5 for libplacebo's AR.
    </p>
    <p>
        SSIM is good at telling us about sharpness and the whole structural profile of the picture, it doesn't care too much about brightness or contrast variations but it'll heavily punish blurriness or sharp transitions
        that shouldn't exist. We can see that Libplacebo's AR is better than PC here (again because it's smoother), with 0.75 strength at the top.
    </p>
    <p>
        MS-SSIM is just SSIM at different scales to emulate a viewer looking at the picture from different distances. This metric tends to correlate better to the human perception of quality than the other 3,
        and if you're not very close to the display this is probably a better metric. For MS-SSIM, the picture with no AR at all is the top scorer. FIR filters need to overshoot a little
        bit to reach some intensity levels and in this case (since polar lanczossharp isn't that sharp to begin with), the ringing doesn't seem to be a big enough problem for it to hurt the score.
        This isn't true for all filters and it might not be true for all scaling factors either, but for polar lanczossharp at 2x you could perhaps make an argument that AR might be unnecessary.
    </p>
    <p>
        To conclude, my opinion is that you can probably skip AR unless you're using a very sharp filter. If you want to use AR though, the ideal strength will depend on the choice of filter, scaling factor and content type, but
        something around 0.6 should be pretty safe (if you want to use PC for the higher PSNR you should probably use it at higher strengths like 0.8).
    </p>
    <h3 id="downsampling_antiring">Downsampling Antiring</h3>
    <p>
        Pixel Clipper actually has a downsampling variant as well, which I believe is probably less broken than mpv's native <inline_code>--dscale-antiring</inline_code> solution for orthogonal filters.
        Libplacebo's new polar AR has been recently enabled for downsampling as well, so we can also test that here.
    </p>
    <h3 id="downsampling_antiring_methodology">Downsampling Antiring Methodology</h3>
    <p>
        My current method to evaluate downsampling filters is to concede that at 0.5x linear light box is as good as it gets, since in this case we're just averaging 4 pixels together.
        We can't use box itself for other scaling factors though, so the aim is to find a filter that produces a similar result while also being usable at any other arbitrary scaling factor.
    </p>
    <p>
        The same violet.png test image was used to test downsampling AR, and it was downsampled with ImageMagick as follows:
    </p>
    <code>
        magick convert violet.png -colorspace RGB -filter box -resize 50% -colorspace sRGB reference.png
    </code>
    <p>
        The images were basically generated using the following commands:
    </p>
    <code>mpv --no-config --vo=gpu-next --no-hidpi-window-scale --window-scale=0.5 --pause=yes --screenshot-format=png --linear-downscaling --correct-downscaling --deband=no --dither-depth=no --screenshot-high-bit-depth=no --dscale=filter --glsl-shader="Pixel Clipper_downscaling.glsl" violet.png</code>
    <br><br>
    <code>mpv --no-config --vo=gpu-next --no-hidpi-window-scale --window-scale=0.5 --pause=yes --screenshot-format=png --linear-downscaling --correct-downscaling --deband=no --dither-depth=no --screenshot-high-bit-depth=no --dscale=filter --scale-antiring=1.0 violet.png</code>
    <p>
      Please note that you have to set <inline_code>--scale-antiring=1.0</inline_code> instead of <inline_code>--dscale-antiring=1.0</inline_code>. That's probably a bug but it is what it is.
    </p>
    <h3 id="downsampling_antiring_results">Downsampling Antiring Results</h3>
    <p>
      <table>
        <tbody>
          <tr>
            <td>Filter</td>
            <td>MAE</td>
            <td>PSNR</td>
            <td>SSIM</td>
            <td>MS-SSIM</td>
            <td></td>
            <td>MAE (N)</td>
            <td>PSNR (N)</td>
            <td>SSIM (N)</td>
            <td>MS-SSIM (N)</td>
            <td></td>
            <td>Mean</td>
          </tr>
          <tr>
            <td>catrom_pc</td>
            <td>1.69E-03</td>
            <td>49.0252</td>
            <td>0.9976</td>
            <td>0.9997</td>
            <td></td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td>1.0000</td>
            <td>0.9904</td>
            <td></td>
            <td>0.9976</td>
          </tr>
          <tr>
            <td>catrom</td>
            <td>1.70E-03</td>
            <td>48.7158</td>
            <td>0.9975</td>
            <td>0.9997</td>
            <td></td>
            <td>0.9889</td>
            <td>0.9342</td>
            <td>0.9861</td>
            <td>1.0000</td>
            <td></td>
            <td>0.9773</td>
          </tr>
          <tr>
            <td>lanczos_pc</td>
            <td>1.78E-03</td>
            <td>48.7595</td>
            <td>0.9974</td>
            <td>0.9997</td>
            <td></td>
            <td>0.8918</td>
            <td>0.9435</td>
            <td>0.9396</td>
            <td>0.8517</td>
            <td></td>
            <td>0.9066</td>
          </tr>
          <tr>
            <td>polar_lanczossharp_ar</td>
            <td>1.85E-03</td>
            <td>47.3664</td>
            <td>0.9970</td>
            <td>0.9997</td>
            <td></td>
            <td>0.8022</td>
            <td>0.6470</td>
            <td>0.7183</td>
            <td>0.7255</td>
            <td></td>
            <td>0.7232</td>
          </tr>
          <tr>
            <td>polar_lanczossharp_pc</td>
            <td>2.05E-03</td>
            <td>46.9530</td>
            <td>0.9968</td>
            <td>0.9997</td>
            <td></td>
            <td>0.5401</td>
            <td>0.5590</td>
            <td>0.6008</td>
            <td>0.6447</td>
            <td></td>
            <td>0.5862</td>
          </tr>
          <tr>
            <td>lanczos</td>
            <td>2.09E-03</td>
            <td>46.4377</td>
            <td>0.9967</td>
            <td>0.9996</td>
            <td></td>
            <td>0.4900</td>
            <td>0.4493</td>
            <td>0.5663</td>
            <td>0.5351</td>
            <td></td>
            <td>0.5102</td>
          </tr>
          <tr>
            <td>hermite</td>
            <td>2.09E-03</td>
            <td>45.8359</td>
            <td>0.9966</td>
            <td>0.9996</td>
            <td></td>
            <td>0.4854</td>
            <td>0.3213</td>
            <td>0.5352</td>
            <td>0.3482</td>
            <td></td>
            <td>0.4225</td>
          </tr>
          <tr>
            <td>hermite_pc</td>
            <td>2.17E-03</td>
            <td>45.7873</td>
            <td>0.9965</td>
            <td>0.9996</td>
            <td></td>
            <td>0.3857</td>
            <td>0.3109</td>
            <td>0.4918</td>
            <td>0.2945</td>
            <td></td>
            <td>0.3707</td>
          </tr>
          <tr>
            <td>polar_lanczossharp</td>
            <td>2.46E-03</td>
            <td>44.8483</td>
            <td>0.9957</td>
            <td>0.9996</td>
            <td></td>
            <td>0.0147</td>
            <td>0.1111</td>
            <td>0.0607</td>
            <td>0.2214</td>
            <td></td>
            <td>0.1020</td>
          </tr>
          <tr>
            <td>mitchell</td>
            <td>2.41E-03</td>
            <td>44.3562</td>
            <td>0.9956</td>
            <td>0.9995</td>
            <td></td>
            <td>0.0863</td>
            <td>0.0063</td>
            <td>0.0362</td>
            <td>0.0535</td>
            <td></td>
            <td>0.0456</td>
          </tr>
          <tr>
            <td>mitchell_pc</td>
            <td>2.48E-03</td>
            <td>44.3264</td>
            <td>0.9956</td>
            <td>0.9995</td>
            <td></td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td>0.0000</td>
            <td></td>
            <td>0.0000</td>
          </tr>
        </tbody>
      </table>
    </p>
    <h3 id="downsampling_antiring_commentary">Downsampling Antiring Commentary</h3>
    <p>
        The first thing we can see is that AR seems to be a net-positive in general when using ringy filters. Only Mitchell and Hermite got worse with AR.
    </p>
    <p>
        It's also good to see that libplacebo's AR seems to work even better when downsampling, as it can remove ringing without introducing any significant blur. This consolidates that there's little reason to use Pixel Clipper over
        Libplacebo's native AR if you're using polar filters.
    </p>
    <p>
        Personally, I'd say you probably need some kind of AR for anything sharper than catrom, but catrom itself is still perfectly usable without AR.
    </p>
    <h3 id="performance">Performance Benchmarks</h3>
    <p>
        Benchmarking mpv performance is a bit tricky due to a few things:
        <ol>
            <li>
                Due to the relatively cheap load, it's difficult to predict at which power state the GPU will stay at while we benchmark. To virtually increase the load, in an attempt to level the ground,
                we can cheese mpv into outputting frames as quickly as possible, but that's not necessarily representative of a real-world scenario.
            </li>
            <li>
                Hardware, OS, drivers, display servers, etc... All of those things affect mpv performance in complex ways that are usually unpredictable, so even if my benchmarks were perfect they'd still only be relevant for those with similar systems.
            </li>
        </ol>
    </p>
    <p>
        In any case, the following numbers were produced with these mpv settings with a 720p anime episode (~24 minutes long video) on a 5600X+6600XT+Windows11 setup:
        <br>
        <br>
        <code>
            Measure-Command { mpv --no-config --vo=gpu-next --gpu-api=vulkan --audio=no --untimed=yes --video-sync=display-desync --vulkan-swap-mode=immediate --window-scale=2.0 --fullscreen=yes }
        </code>
    </p>
    <p>
      <table>
        <tbody>
          <tr>
            <td>Preset/Shader</td>
            <td>FPS</td>
            <td>Time</td>
            <td>Relative</td>
          </tr>
          <tr>
            <td>fast</td>
            <td>2057</td>
            <td>41.71</td>
            <td>1.0000</td>
          </tr>
          <tr>
            <td>default</td>
            <td>1615</td>
            <td>53.13</td>
            <td>0.7851</td>
          </tr>
          <tr>
            <td>fastbilateral</td>
            <td>1605</td>
            <td>53.46</td>
            <td>0.7802</td>
          </tr>
          <tr>
            <td>jointbilateral</td>
            <td>1544</td>
            <td>55.57</td>
            <td>0.7506</td>
          </tr>
          <tr>
            <td>cfl_lite</td>
            <td>1509</td>
            <td>56.85</td>
            <td>0.7337</td>
          </tr>
          <tr>
            <td>ravu-lite-r2</td>
            <td>1453</td>
            <td>59.04</td>
            <td>0.7065</td>
          </tr>
          <tr>
            <td>cfl</td>
            <td>1435</td>
            <td>59.80</td>
            <td>0.6975</td>
          </tr>
          <tr>
            <td>krigbilateral</td>
            <td>1417</td>
            <td>60.55</td>
            <td>0.6888</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r2</td>
            <td>1411</td>
            <td>60.81</td>
            <td>0.6859</td>
          </tr>
          <tr>
            <td>ravu-lite-r3</td>
            <td>1384</td>
            <td>61.98</td>
            <td>0.6730</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r3</td>
            <td>1369</td>
            <td>62.68</td>
            <td>0.6654</td>
          </tr>
          <tr>
            <td>ravu-zoom-r2</td>
            <td>1364</td>
            <td>62.89</td>
            <td>0.6632</td>
          </tr>
          <tr>
            <td>high-quality</td>
            <td>1351</td>
            <td>63.50</td>
            <td>0.6568</td>
          </tr>
          <tr>
            <td>ravu-lite-r4</td>
            <td>1292</td>
            <td>66.40</td>
            <td>0.6281</td>
          </tr>
          <tr>
            <td>ravu-lite-ar-r4</td>
            <td>1287</td>
            <td>66.66</td>
            <td>0.6257</td>
          </tr>
          <tr>
            <td>ravu-zoom-ar-r2</td>
            <td>1278</td>
            <td>67.16</td>
            <td>0.6210</td>
          </tr>
          <tr>
            <td>FSR</td>
            <td>1255</td>
            <td>68.35</td>
            <td>0.6102</td>
          </tr>
          <tr>
            <td>high-quality+AR</td>
            <td>1178</td>
            <td>72.86</td>
            <td>0.5724</td>
          </tr>
          <tr>
            <td>pixelclipper</td>
            <td>1127</td>
            <td>76.13</td>
            <td>0.5479</td>
          </tr>
          <tr>
            <td>ravu-zoom-r3</td>
            <td>1088</td>
            <td>78.83</td>
            <td>0.5291</td>
          </tr>
          <tr>
            <td>nnedi3-nns32-win8x4</td>
            <td>1008</td>
            <td>85.13</td>
            <td>0.4900</td>
          </tr>
          <tr>
            <td>ravu-zoom-ar-r3</td>
            <td>1006</td>
            <td>85.33</td>
            <td>0.4888</td>
          </tr>
          <tr>
            <td>FSRCNNX_x2_8-0-4-1</td>
            <td>912</td>
            <td>94.08</td>
            <td>0.4433</td>
          </tr>
          <tr>
            <td>ArtCNN_C4F8</td>
            <td>903</td>
            <td>95.03</td>
            <td>0.4389</td>
          </tr>
          <tr>
            <td>nnedi3-nns64-win8x4</td>
            <td>640</td>
            <td>134.07</td>
            <td>0.3111</td>
          </tr>
          <tr>
            <td>ArtCNN_C4F16</td>
            <td>402</td>
            <td>213.66</td>
            <td>0.1952</td>
          </tr>
          <tr>
            <td>FSRCNNX_x2_16-0-4-1</td>
            <td>359</td>
            <td>238.75</td>
            <td>0.1747</td>
          </tr>
        </tbody>
      </table>
    </p>
    <p>
        Please keep in mind that the choice of built-in filter doesn't matter that much as the weights get stored in a LUT, so something like lanczos and spline36 have virtually identical performance. In short, filters
        with larger radii will obviously be slower, polar filters are slower than their orthogonal counterparts and AR obviously also makes things slower.
    </p>
    <p>
        For the shaders, the number are more or less what I expected, but it's nice to see that in the grand scheme of things these shaders don't really slow the playback down that much. Good old polar lanczossharp with AR is already as slow as most shaders.
    </p>
    <p>
        Still though, the conclusion here seems to be that if you're running mpv on a semi-decent computer, these shaders will never be a problem.
    </p>
    <h3 id="outro">Outro</h3>
    <p>
        I want to make it clear though that you shouldn't take the results as gospel. Mathematical image quality metrics do not always correlate perfectly with how humans perceive image quality,
        and your personal preference is entirely subjective. You should take this page as what it is, a research that produces numbers, but you should not take these numbers for granted before
        understanding what they actually mean.
    </p>
</section>
        <br>
        <br>
        <nav>
            <menu>
                <a href="../index.html">Home</a>
                <a href="#introduction">Introduction</a>
                <a href="https://github.com/Artoriuz">GitHub</a>
                <a href="https://www.linkedin.com/in/jvrchrisostomo/">LinkedIn</a>
            </menu>
        </nav>
        <br>
        <br>
</body>
</html>
