<!DOCTYPE html>
<html lang="en">

<head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135192850-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-135192850-1');
    </script>

    <title>Mathematically Evaluating mpv's Resampling Algorithms</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="./css/default.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Roboto+Slab&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <hgroup>
            <h1>
                Mathematically Evaluating mpv's Resampling Algorithms
            </h1>
            <h2>The return of the memes</h2>
        </hgroup>
    </header>
    <nav>
        <menu>
            <a href="../index.html">Home</a>
            <a href="https://github.com/Artoriuz">GitHub</a>
            <a href="https://www.linkedin.com/in/jvrchrisostomo/">LinkedIn</a>
        </menu>
    </nav>
    <section>
        <h3 id="introduction">Introduction</h3>
        <p>
            This page is meant to be treated as a follow-up to this scaler comparison done with <a href="https://artoriuz.github.io/blog/imagemagick_resampling.html">ImageMagick</a>. I'm only going to talk about niche topics here, 
            so just refer to that other page if you only want to read about scalers.
        </p>
        <h3 id="upsampling_shaders">Upsampling Shaders</h3>
        <p>
            The mpv community has written several <s>meme</s> shaders you can use to upsample video in real time, and the rationale is that they can potentially achieve higher quality than the built-in methods. I still do not have a good way of 
            automating mpv tests and therefore I'll have to stick to a single test image, which is still going to be violet.png just because I'm familiarised with it. If this is your first time reading these posts, this is what violet.png looks like:
        </p>
        <p>
            <img src="./images/mpv_upscaling/upsampling/violet.png" alt="Violet" class="center" width="960" height="540">
        </p>
        <p>
            The small number of samples under test makes this very unscientific, but it is what it is.
        </p>
        <h3 id="upsampling_methodology">Upsampling Methodology</h3>
        <p>
            The following shaders were "benchmarked":
            <li><a href="https://github.com/bjin/mpv-prescalers">RAVU</a></li>
            <li><a href="https://github.com/igv/FSRCNN-TensorFlow">FSRCNNX</a></li>
            <li><a href="https://github.com/bloc97/Anime4K">Anime4K</a></li>
            <li><a href="https://gist.github.com/agyild/82219c545228d70c5604f865ce0b0ce5">FSR</a></li>
            <br>
            I've also added polar Lanczos to the mix just to have a reference point, but feel free to send me any other shaders you would like to get scored. 
            Also note that the Anime4K author recommends using multiple shaders together, but I'm only interested in the upscaling CNNs here.
        </p>
        <p>
            The test image is downsampled with:
        </p>                    
        <code>magick convert violet.png -colorspace rgb -filter box -resize 50% -colorspace srgb downscaled.png</code>
        <p>
            It is then converted to grayscale with:
        </p>
        <code>magick convert downscaled.png -colorspace gray downscaled.png</code>
        <p>
            We need to convert them to grayscale because some of these shaders do not have RGB support.
        </p>
        <p>
            The images were then upsampled back with:
        </p>
        <code>mpv --no-config --vo=gpu-next --no-hidpi-window-scale --window-scale=2.0 --pause=yes --screenshot-format=png --sigmoid-upscaling --deband=no --dither-depth=no --screenshot-high-bit-depth=no --glsl-shader="path/to/meme/shader" downscaled.png</code>
        <h3 id="upsampling_results">Upsampling Results</h3>
        <p>
            <table>
                <tbody>
                  <tr>
                    <td>Shader/Filter</td>
                    <td>MAE</td>
                    <td>PSNR</td>
                    <td>SSIM</td>
                    <td>MS-SSIM</td>
                    <td></td>
                    <td>MAE (N)</td>
                    <td>PSNR (N)</td>
                    <td>SSIM (N)</td>
                    <td>MS-SSIM (N)</td>
                    <td></td>
                    <td>Mean</td>
                  </tr>
                  <tr>
                    <td>FSRCNNX_x2_8-0-4-1</td>
                    <td>0.0038</td>
                    <td>40.9503</td>
                    <td>0.9882</td>
                    <td>0.9987</td>
                    <td></td>
                    <td>1.0000</td>
                    <td>1.0000</td>
                    <td>1.0000</td>
                    <td>1.0000</td>
                    <td></td>
                    <td>1.0000</td>
                  </tr>
                  <tr>
                    <td>ravu-zoom-ar-r3</td>
                    <td>0.0038</td>
                    <td>40.1300</td>
                    <td>0.9869</td>
                    <td>0.9985</td>
                    <td></td>
                    <td>0.9695</td>
                    <td>0.8437</td>
                    <td>0.8911</td>
                    <td>0.8769</td>
                    <td></td>
                    <td>0.8953</td>
                  </tr>
                  <tr>
                    <td>FSRCNNX_x2_16-0-4-1</td>
                    <td>0.0040</td>
                    <td>39.9168</td>
                    <td>0.9873</td>
                    <td>0.9984</td>
                    <td></td>
                    <td>0.8801</td>
                    <td>0.8030</td>
                    <td>0.9247</td>
                    <td>0.8541</td>
                    <td></td>
                    <td>0.8655</td>
                  </tr>
                  <tr>
                    <td>ravu-zoom-ar-r2</td>
                    <td>0.0040</td>
                    <td>39.7097</td>
                    <td>0.9860</td>
                    <td>0.9984</td>
                    <td></td>
                    <td>0.9049</td>
                    <td>0.7635</td>
                    <td>0.8079</td>
                    <td>0.8666</td>
                    <td></td>
                    <td>0.8357</td>
                  </tr>
                  <tr>
                    <td>FSR</td>
                    <td>0.0051</td>
                    <td>39.0008</td>
                    <td>0.9817</td>
                    <td>0.9981</td>
                    <td></td>
                    <td>0.3916</td>
                    <td>0.6284</td>
                    <td>0.4552</td>
                    <td>0.6647</td>
                    <td></td>
                    <td>0.5350</td>
                  </tr>
                  <tr>
                    <td>polar_lanczos</td>
                    <td>0.0050</td>
                    <td>37.9718</td>
                    <td>0.9806</td>
                    <td>0.9980</td>
                    <td></td>
                    <td>0.4426</td>
                    <td>0.4323</td>
                    <td>0.3575</td>
                    <td>0.5797</td>
                    <td></td>
                    <td>0.4530</td>
                  </tr>
                  <tr>
                    <td>Anime4K_Upscale_CNN_x2_S</td>
                    <td>0.0054</td>
                    <td>36.7883</td>
                    <td>0.9795</td>
                    <td>0.9974</td>
                    <td></td>
                    <td>0.2346</td>
                    <td>0.2068</td>
                    <td>0.2677</td>
                    <td>0.2762</td>
                    <td></td>
                    <td>0.2463</td>
                  </tr>
                  <tr>
                    <td>Anime4K_Upscale_CNN_x2_VL</td>
                    <td>0.0055</td>
                    <td>36.1490</td>
                    <td>0.9794</td>
                    <td>0.9971</td>
                    <td></td>
                    <td>0.2006</td>
                    <td>0.0849</td>
                    <td>0.2564</td>
                    <td>0.0930</td>
                    <td></td>
                    <td>0.1587</td>
                  </tr>
                  <tr>
                    <td>Anime4K_Upscale_CNN_x2_UL</td>
                    <td>0.0056</td>
                    <td>35.9095</td>
                    <td>0.9790</td>
                    <td>0.9971</td>
                    <td></td>
                    <td>0.1788</td>
                    <td>0.0393</td>
                    <td>0.2300</td>
                    <td>0.0561</td>
                    <td></td>
                    <td>0.1260</td>
                  </tr>
                  <tr>
                    <td>Anime4K_Upscale_CNN_x2_L</td>
                    <td>0.0058</td>
                    <td>35.7035</td>
                    <td>0.9772</td>
                    <td>0.9972</td>
                    <td></td>
                    <td>0.0874</td>
                    <td>0.0000</td>
                    <td>0.0768</td>
                    <td>0.1609</td>
                    <td></td>
                    <td>0.0813</td>
                  </tr>
                  <tr>
                    <td>Anime4K_Upscale_CNN_x2_M</td>
                    <td>0.0060</td>
                    <td>35.7087</td>
                    <td>0.9763</td>
                    <td>0.9970</td>
                    <td></td>
                    <td>0.0000</td>
                    <td>0.0010</td>
                    <td>0.0000</td>
                    <td>0.0000</td>
                    <td></td>
                    <td>0.0002</td>
                  </tr>
                </tbody>
            </table>
        </p>
    <h3 id="upsampling_commentary">Upsampling Commentary</h3>
    <p>
        The funniest thing about these results is that, according to distortion metrics, Anime4K is actually worse at "recreating the ground truth" than polar Lanczos. 
        The problem seems to be that the shader is too sharp, it does not only ring but also makes the lines thinner. This isn't necessarily bad depending on how blurry your source is, but my test image here isn't 
        blurry at all.
    </p>
    <p>
        The slower variant of FSRCNNX is also scored lower than its smaller sibling, presumably for the same reason. I don't think igv trained these networks with images that had been downsampled in linear light, so that's probably part 
        of the problem.
    </p>
    <p>
        The overly-sharp shaders would probably do much better on perceptual metrics, I'll evaluate whether adding a few of them to the benchmarking script makes sense on a later date.
    </p>
    <p>
        It's nice to see that bjin came back from the dead with gold. ravu-zoom-ar-r3 performs much better than its previous iterations and it's also free of the half-pixel shift problem.
    </p>
    <p>
        In any case, if you were looking for a doubler FSRCNNX_x2_8-0-4-1 is probably a safe bet. It was the best scoring shader on all 4 distortion metrics.
    </p>
    <h3 id="chroma_shaders">Chroma Shaders</h3>
    <p>
        Using shaders to upsample chroma is an old meme, as igv ported Shiandow's KrigBilateral to mpv years ago. KrigBilateral finds the correlation between luma and chroma, and then maps the missing values based on that. 
        You can read more about it <a href="https://en.wikipedia.org/wiki/Kriging">here</a>.
    </p>
    <p>
        There's a different technique, usually called Joint or Cross Bilateral, that simply uses luma as an extra weighting factor. In short, chromatic information from pixels with similar luminosities is preferred. <a href="">I've written a shader that 
        implements this idea</a> mostly to learn GLSL, but it ended up being quite useful as it's much faster than KrigBilateral while still keeping a clear lead over classic methods.
    </p>
    <p>
        In any case, my goal here is to compare these chroma shaders against polar Lanczos, which I'm using as a reference poing.
    </p>
    <h3 id="chroma_methodology">Chroma Methodology</h3>
    <p>
        This test is a little different and it requires a slightly more elaborate process. The first problem with this is that, with real video content, we rarely get a 4:4:4 copy. This means that we generally don't have a reference point 
        to work with, so we have to create one on our own.
    </p>
    <p>
        I've semi-arbitrarily decided to use a downsampled version of <a href="https://twitter.com/fujinoomori/status/1576159422040064001">this danmachi fanart</a>. This image is particularly good at showing the difference between these shaders 
        because it's full of pixel-to-pixel chromatic deviations, specially in the red areas. I might change this to a different test image at a later date, but for now it'll do.
    </p>
    <p>
        This is what the original test image looks like:
    </p>
    <p>
        <img src="./images/mpv_upscaling/chroma/reference.png" alt="chroma_reference" class="center" width="620" height="666">
    </p>
    <p>
        Two versions of the image were created using FFmpeg:
    </p>
    <code>ffmpeg -i downscaled.png -pix_fmt yuv444p10le -c:v libx264 -preset placebo -qp 0 -an danmachi444.mp4</code>
    <br>
    <code>ffmpeg -i downscaled.png -pix_fmt yuv420p10le -c:v libx264 -preset placebo -qp 0 -an danmachi420.mp4</code>
    <p>
        The idea here was creating (nearly) lossless variants with and without chroma subsampling.
    </p>
    <p>
        The "reference" image was obtained by screenshotting "danmachi444.mp4" on mpv.
    </p>
    <p>
        The images under test were obtained by screenshotting "danmachi420.mp4" on mpv using the various chroma resampling shaders.
    </p>
    <p>
        mpv options remains the same with the exception that we don't need <inline_code>--window-scale=2.0</inline_code> anymore. Since we're comparing chroma here, the images weren't converted to grayscale.
    </p>
    <h3 id="chroma_results">Chroma Results</h3>
    <p>
        <table>
            <tbody>
              <tr>
                <td>Shader/Filter</td>
                <td>MAE</td>
                <td>PSNR</td>
                <td>SSIM</td>
                <td>MS-SSIM</td>
                <td></td>
                <td>MAE (N)</td>
                <td>PSNR (N)</td>
                <td>SSIM (N)</td>
                <td>MS-SSIM (N)</td>
                <td></td>
                <td>Mean</td>
              </tr>
              <tr>
                <td>krigbilateral</td>
                <td>0.0025</td>
                <td>41.1124</td>
                <td>0.9941</td>
                <td>0.9994</td>
                <td></td>
                <td>1.0000</td>
                <td>1.0000</td>
                <td>1.0000</td>
                <td>1.0000</td>
                <td></td>
                <td>1.0000</td>
              </tr>
              <tr>
                <td>FastBilateral</td>
                <td>0.0028</td>
                <td>40.0376</td>
                <td>0.9925</td>
                <td>0.9991</td>
                <td></td>
                <td>0.5973</td>
                <td>0.4479</td>
                <td>0.4715</td>
                <td>0.6175</td>
                <td></td>
                <td>0.5335</td>
              </tr>
              <tr>
                <td>JointBilateral</td>
                <td>0.0029</td>
                <td>39.9786</td>
                <td>0.9923</td>
                <td>0.9990</td>
                <td></td>
                <td>0.4964</td>
                <td>0.4176</td>
                <td>0.4033</td>
                <td>0.5301</td>
                <td></td>
                <td>0.4619</td>
              </tr>
              <tr>
                <td>polar_lanczos</td>
                <td>0.0032</td>
                <td>39.1656</td>
                <td>0.9911</td>
                <td>0.9987</td>
                <td></td>
                <td>0.0000</td>
                <td>0.0000</td>
                <td>0.0000</td>
                <td>0.0000</td>
                <td></td>
                <td>0.0000</td>
              </tr>
            </tbody>
        </table>
    </p>
    <h3 id="chroma_commentary">Chroma Commentary</h3>
    <p>
        As expected, the bilateral filters are all capable of getting closer to the ground truth than polar Lanczos. KrigBilateral is the best scorer here, which was also expected given it's the slowest shader.
    </p>
    <p>
        FastBilateral scoring higher than JointBilateral might seem weird at first, but at their default settings (with <inline_code>intensity_coeff = 64.0</inline_code>) this can happen sometimes. JointBilateral takes a neighbourhood 
        of 16 chroma pixels while FastBilateral only uses the 4 surrounding pixels. This much greater radius allows JointBilateral to "look far away", which is usually beneficial but can also work against it when the surrounding pixels 
        are close together in luminance but far apart in chromaticity.
    </p>
    <p>
        My personal advice here is that there's little point in using JointBilateral over FastBilateral, even when it does better the difference is usually negligible. Krig is also better than both of them at the expense of being much slower to run 
        (about an order of magnitude slower than FastBilateral), but if your hardware can handle it then that's a non-issue.
    </p>
    <p>
        The table also shows us that, if you use polar Lanczos as the baseline, Joint/Fast Bilateral are pretty much half-way as good as KrigBilateral. The shaders would be much closer together in the final mean if I had included faster 
        options such as bilinear and box, but there's little reason to use those to scale chroma unless you're really trying to save on resources.
    </p>
    <p>
        The only other thing I'd like to point out here is that the difference between these 3 shaders and the built-in solutions gets bigger when you use luma prescalers, since they use luma information as a guide.
    </p>
    <h3 id="antiring">Antiring</h3>
    <p>
        Antiringing solutions is a topic that I hadn't covered in the previous iteration of this page, but now that we have more than a single option we can also compare them.
    </p>
    <p>
        In short, antiringing filters attempt to remove overshoots generated by sharp resampling filters when they meet a sharp intensity delta. What is commonly referred to as ringing is simply consequential to the filter's impulse response.
    </p>
    <p>
        The following image shows this very well:
    </p>
    <p>
        <img src="./images/mpv_upscaling/antiring/ar_comparison.png" alt="ar_comparison" class="center" width="900" height="300">
    </p>
    <p>
        The negative weights in the filter are there for it to be able to quickly respond to high-frequency transitions, but it makes the filter overshoot a little bit before reaching its final destination. The "intensity" of the ringing is 
        directly related to the magnitude of the secondary lobes. The second lobe, which is almost always negative, is responsible for the overshooting in can see in this example, but filters with more lobes ring once per lobe, and the ringing can 
        be "positive" as well (within the range set by the original pixels) with positive lobes. The "length" of the rings is directly related to the length of the lobes, which is why filters like polar Lanczos have "longer" rings (the zero crossings 
        don't fall exactly at the integers, but rather slightly after them).
    </p>
    <h3 id="antiring_methodology">Antiring Methodology</h3>
    <p>
        The methodology here almost is equal to the one used for upsampling, with the only difference being that we have to include <inline_code>--scale-antiring</inline_code> to use mpv's (or libplacebo's) native AR solution. We also don't have to convert to grayscale 
        this time since the shaders support RGB images just fine.
    </p>
    <p>
        AR is only really necessary when you're using sharp filters, it makes no sense alongside blurry filters because blurry filters don't ring hard enough for it to be noticeable. Polar Lanczos is a relatively blurry filter, and it's probably not 
        the best candidate to test this with, however, it's also the most popular polar choice so using something else probably wouldn't be very useful to a lot of people... There are a few sharp memes that are worth trying with AR though if you feel adventurous, 
        but enerally speaking I think orthogonal lanczos and polar lanczos are pretty balanced.
    </p>
    <p>
        It's also worth mentioning that mpv uses different AR techniques for orthogonal and polar filters, but I'll name them both "_ar" for simplicity.
    </p>
    <p>
        I'm including <a href="https://github.com/Artoriuz/glsl-pixel-clipper">my AR shaders</a> in this comparison because I think they're very good at keeping everything but the overshoots intact, which does create some weird artifacts with sharp transitions sometimes, 
        specially if you use them at ludicrous scaling factors, but the output is generally clean enough on real content.
    </p>
    <h3 id="antiring_results">Antiring Results</h3>
    <p>
        <table>
            <tbody>
              <tr>
                <td>Filter</td>
                <td>MAE</td>
                <td>PSNR</td>
                <td>SSIM</td>
                <td>MS-SSIM</td>
                <td></td>
                <td>MAE (N)</td>
                <td>PSNR (N)</td>
                <td>SSIM (N)</td>
                <td>MS-SSIM (N)</td>
                <td></td>
                <td>Mean</td>
              </tr>
              <tr>
                <td>lanczos_pc4_100</td>
                <td>0.0045</td>
                <td>38.4763</td>
                <td>0.9831</td>
                <td>0.9985</td>
                <td></td>
                <td>1.0000</td>
                <td>0.9917</td>
                <td>1.0000</td>
                <td>0.9052</td>
                <td></td>
                <td>0.9742</td>
              </tr>
              <tr>
                <td>lanczos_pc4_75</td>
                <td>0.0046</td>
                <td>38.4828</td>
                <td>0.9830</td>
                <td>0.9985</td>
                <td></td>
                <td>0.9595</td>
                <td>0.9970</td>
                <td>0.9820</td>
                <td>0.9400</td>
                <td></td>
                <td>0.9696</td>
              </tr>
              <tr>
                <td>lanczos_pc4_50</td>
                <td>0.0047</td>
                <td>38.4633</td>
                <td>0.9827</td>
                <td>0.9986</td>
                <td></td>
                <td>0.8656</td>
                <td>0.9810</td>
                <td>0.9252</td>
                <td>0.9708</td>
                <td></td>
                <td>0.9356</td>
              </tr>
              <tr>
                <td>lanczos_pc12_100</td>
                <td>0.0046</td>
                <td>38.4865</td>
                <td>0.9827</td>
                <td>0.9985</td>
                <td></td>
                <td>0.8785</td>
                <td>1.0000</td>
                <td>0.9247</td>
                <td>0.9392</td>
                <td></td>
                <td>0.9356</td>
              </tr>
              <tr>
                <td>lanczos_pc12_75</td>
                <td>0.0047</td>
                <td>38.4782</td>
                <td>0.9826</td>
                <td>0.9986</td>
                <td></td>
                <td>0.8490</td>
                <td>0.9932</td>
                <td>0.9080</td>
                <td>0.9606</td>
                <td></td>
                <td>0.9277</td>
              </tr>
              <tr>
                <td>lanczos_pc12_50</td>
                <td>0.0047</td>
                <td>38.4522</td>
                <td>0.9824</td>
                <td>0.9986</td>
                <td></td>
                <td>0.7875</td>
                <td>0.9720</td>
                <td>0.8652</td>
                <td>0.9810</td>
                <td></td>
                <td>0.9014</td>
              </tr>
              <tr>
                <td>lanczos_ar_50</td>
                <td>0.0047</td>
                <td>38.3433</td>
                <td>0.9826</td>
                <td>0.9985</td>
                <td></td>
                <td>0.8445</td>
                <td>0.8833</td>
                <td>0.8959</td>
                <td>0.9221</td>
                <td></td>
                <td>0.8864</td>
              </tr>
              <tr>
                <td>lanczos_ar_75</td>
                <td>0.0046</td>
                <td>38.2819</td>
                <td>0.9827</td>
                <td>0.9984</td>
                <td></td>
                <td>0.9069</td>
                <td>0.8332</td>
                <td>0.9150</td>
                <td>0.8578</td>
                <td></td>
                <td>0.8782</td>
              </tr>
              <tr>
                <td>lanczos_ar_100</td>
                <td>0.0046</td>
                <td>38.1854</td>
                <td>0.9826</td>
                <td>0.9983</td>
                <td></td>
                <td>0.9200</td>
                <td>0.7545</td>
                <td>0.8971</td>
                <td>0.7848</td>
                <td></td>
                <td>0.8391</td>
              </tr>
              <tr>
                <td>lanczos</td>
                <td>0.0048</td>
                <td>38.3682</td>
                <td>0.9819</td>
                <td>0.9986</td>
                <td></td>
                <td>0.6477</td>
                <td>0.9035</td>
                <td>0.7435</td>
                <td>1.0000</td>
                <td></td>
                <td>0.8237</td>
              </tr>
              <tr>
                <td>polar_lanczos_pc4_100</td>
                <td>0.0048</td>
                <td>38.0367</td>
                <td>0.9817</td>
                <td>0.9982</td>
                <td></td>
                <td>0.7189</td>
                <td>0.6333</td>
                <td>0.7049</td>
                <td>0.6973</td>
                <td></td>
                <td>0.6886</td>
              </tr>
              <tr>
                <td>polar_lanczos_pc4_75</td>
                <td>0.0048</td>
                <td>38.0387</td>
                <td>0.9816</td>
                <td>0.9983</td>
                <td></td>
                <td>0.6737</td>
                <td>0.6350</td>
                <td>0.6829</td>
                <td>0.7259</td>
                <td></td>
                <td>0.6794</td>
              </tr>
              <tr>
                <td>polar_lanczos_pc12_100</td>
                <td>0.0049</td>
                <td>38.0394</td>
                <td>0.9813</td>
                <td>0.9983</td>
                <td></td>
                <td>0.5989</td>
                <td>0.6356</td>
                <td>0.6284</td>
                <td>0.7247</td>
                <td></td>
                <td>0.6469</td>
              </tr>
              <tr>
                <td>polar_lanczos_pc4_50</td>
                <td>0.0049</td>
                <td>38.0185</td>
                <td>0.9813</td>
                <td>0.9983</td>
                <td></td>
                <td>0.5775</td>
                <td>0.6185</td>
                <td>0.6235</td>
                <td>0.7506</td>
                <td></td>
                <td>0.6425</td>
              </tr>
              <tr>
                <td>polar_lanczos_pc12_75</td>
                <td>0.0049</td>
                <td>38.0308</td>
                <td>0.9812</td>
                <td>0.9983</td>
                <td></td>
                <td>0.5668</td>
                <td>0.6285</td>
                <td>0.6100</td>
                <td>0.7416</td>
                <td></td>
                <td>0.6367</td>
              </tr>
              <tr>
                <td>polar_lanczos_pc12_50</td>
                <td>0.0049</td>
                <td>38.0061</td>
                <td>0.9810</td>
                <td>0.9983</td>
                <td></td>
                <td>0.5011</td>
                <td>0.6084</td>
                <td>0.5641</td>
                <td>0.7566</td>
                <td></td>
                <td>0.6076</td>
              </tr>
              <tr>
                <td>polar_lanczos</td>
                <td>0.0050</td>
                <td>37.9266</td>
                <td>0.9804</td>
                <td>0.9983</td>
                <td></td>
                <td>0.3513</td>
                <td>0.5436</td>
                <td>0.4438</td>
                <td>0.7677</td>
                <td></td>
                <td>0.5266</td>
              </tr>
              <tr>
                <td>polar_lanczos_ar_50</td>
                <td>0.0050</td>
                <td>37.7414</td>
                <td>0.9805</td>
                <td>0.9980</td>
                <td></td>
                <td>0.4390</td>
                <td>0.3926</td>
                <td>0.4499</td>
                <td>0.5096</td>
                <td></td>
                <td>0.4478</td>
              </tr>
              <tr>
                <td>polar_lanczos_ar_75</td>
                <td>0.0051</td>
                <td>37.5336</td>
                <td>0.9797</td>
                <td>0.9977</td>
                <td></td>
                <td>0.3047</td>
                <td>0.2232</td>
                <td>0.2849</td>
                <td>0.2863</td>
                <td></td>
                <td>0.2748</td>
              </tr>
              <tr>
                <td>polar_lanczos_ar_100</td>
                <td>0.0053</td>
                <td>37.2597</td>
                <td>0.9783</td>
                <td>0.9973</td>
                <td></td>
                <td>0.0000</td>
                <td>0.0000</td>
                <td>0.0000</td>
                <td>0.0000</td>
                <td></td>
                <td>0.0000</td>
              </tr>
            </tbody>
        </table>
    </p>
    <h3 id="antiring_commentary">Antiring Commentary</h3>
    <p>
        When it comes to the AR solutions we have available today, libplacebo's native AR is better at keeping gradients smooth at the expense of blurrying the image a little bit, which explains why Pixel Clipper scores higher than it.
    </p>
    <p>
        mpv's native AR solution for orthogonal filters shouldn't blur anything though, and I believe PixelClipper is only scoring higher than it because mpv applies its antiring twice, once per orthogonal pass. This means that the second pass 
        won't have access to the overshoots created by the first pass, which is theoretically a good thing but actually ends up hurting the filter's reconstruction quality. Pixel Clipper is only applied after scaling is done, so it's completely 
        oblivious to the entire scaling process. It simply clamps the HR pixels to the intensity bounds set by the surrounding LR pixels.
    </p>
    <p>
        I think this is pretty much a pick your poison kind of situation, though my judgement might be biased.
    </p>
    <h3 id="downsampling_antiring">Downsampling Antiring</h3>
    <p>
        Pixel Clipper actually has a downsampling variant as well, which I believe is probably less broken than mpv's native <inline_code>--dscale-antiring</inline_code> solution. My aim here is to evaluate whether using AR 
        when downsampling helps at all, so I'll skip comparing it against the old native solution and I'll only run it at full strength.
    </p>
    <p>
        I'm only including orthogonal mitchell, catrom and spline36 and lanczos in this section, as these are the most popular choices for downsampling. 
        The following image was used for the downsampling tests:
    </p>
    <img src="./images/mpv_upscaling/downsampling/highres.png" alt="yurucamp" class="center" width="960" height="540">
    <h3 id="downsampling_antiring_methodology">Downsampling Antiring Methodology</h3>
    <p>
        My current method to evaluate downsampling filters is to concede that at 0.5x linear light box is as good as it gets, since in this case we're just averaging 4 pixels together. 
        We can't use box itself for other scaling factors though, so the aim is to find a filter that produces a similar result but is also usable at any other arbitrary scaling factor.
    </p>
    <p>
        To eliminate any differences caused by how differently mpv and ImageMagick perform linear light conversion, the box reference was also obtained using mpv.
    </p>
    <p>
        The images were basically generated using the following command:
    </p>
    <code>mpv --no-config --vo=gpu-next --no-hidpi-window-scale --window-scale=0.5 --pause=yes --screenshot-format=png --linear-downscaling --correct-downscaling --deband=no --dither-depth=no --screenshot-high-bit-depth=no --dscale=filter --glsl-shader="PixelClipper_downscaling.glsl" higres.png</code>
    <h3 id="downsampling_antiring_results">Downsampling Antiring Results</h3>
    <p>
        <table>
            <tbody>
              <tr>
                <td>Filter</td>
                <td>MAE</td>
                <td>PSNR</td>
                <td>SSIM</td>
                <td>MS-SSIM</td>
                <td></td>
                <td>MAE (N)</td>
                <td>PSNR (N)</td>
                <td>SSIM (N)</td>
                <td>MS-SSIM (N)</td>
                <td></td>
                <td>Mean</td>
              </tr>
              <tr>
                <td>catrom_pc</td>
                <td>0.0026</td>
                <td>42.0780</td>
                <td>0.9955</td>
                <td>0.9996</td>
                <td></td>
                <td>1.0000</td>
                <td>1.0000</td>
                <td>1.0000</td>
                <td>1.0000</td>
                <td></td>
                <td>1.0000</td>
              </tr>
              <tr>
                <td>lanczos_pc</td>
                <td>0.0027</td>
                <td>42.0482</td>
                <td>0.9950</td>
                <td>0.9994</td>
                <td></td>
                <td>0.8790</td>
                <td>0.9932</td>
                <td>0.8957</td>
                <td>0.8036</td>
                <td></td>
                <td>0.8929</td>
              </tr>
              <tr>
                <td>spline36_pc</td>
                <td>0.0028</td>
                <td>41.8381</td>
                <td>0.9949</td>
                <td>0.9995</td>
                <td></td>
                <td>0.8468</td>
                <td>0.9449</td>
                <td>0.8750</td>
                <td>0.8317</td>
                <td></td>
                <td>0.8746</td>
              </tr>
              <tr>
                <td>catrom</td>
                <td>0.0030</td>
                <td>40.5637</td>
                <td>0.9948</td>
                <td>0.9994</td>
                <td></td>
                <td>0.7095</td>
                <td>0.6523</td>
                <td>0.8451</td>
                <td>0.7859</td>
                <td></td>
                <td>0.7482</td>
              </tr>
              <tr>
                <td>spline36</td>
                <td>0.0038</td>
                <td>38.3021</td>
                <td>0.9923</td>
                <td>0.9991</td>
                <td></td>
                <td>0.0906</td>
                <td>0.1329</td>
                <td>0.3205</td>
                <td>0.2044</td>
                <td></td>
                <td>0.1871</td>
              </tr>
              <tr>
                <td>mitchell_pc</td>
                <td>0.0038</td>
                <td>38.1842</td>
                <td>0.9908</td>
                <td>0.9990</td>
                <td></td>
                <td>0.1057</td>
                <td>0.1059</td>
                <td>0.0135</td>
                <td>0.0195</td>
                <td></td>
                <td>0.0612</td>
              </tr>
              <tr>
                <td>lanczos</td>
                <td>0.0039</td>
                <td>37.7231</td>
                <td>0.9917</td>
                <td>0.9990</td>
                <td></td>
                <td>0.0000</td>
                <td>0.0000</td>
                <td>0.2069</td>
                <td>0.0000</td>
                <td></td>
                <td>0.0517</td>
              </tr>
              <tr>
                <td>mitchell</td>
                <td>0.0038</td>
                <td>38.1312</td>
                <td>0.9907</td>
                <td>0.9990</td>
                <td></td>
                <td>0.0669</td>
                <td>0.0937</td>
                <td>0.0000</td>
                <td>0.0092</td>
                <td></td>
                <td>0.0425</td>
              </tr>
            </tbody>
        </table>
    </p>
    <h3 id="downsampling_antiring_commentary">Downsampling Antiring Commentary</h3>
    <p>
        The first thing we can see is that AR seems to be a net-positive in general. All filters scored higher with Pixel Clipper, with the sharpest filter in the comparison (Lanczos) seeing the biggest improvement. 
    </p>
    <p>
        Catrom is the highest scoring filter with and without AR, so it's easy to recommend this unless you really prefer the softer look of mitchell.
    </p>
    <p>
        Mitchell itself also saw a small improvement with AR, but using AR with mitchell is completely unnecessary and you're unlikely to notice the difference.
    </p>
    <h3 id="outro">Outro</h3>
    <p>
        I want to make it clear though that you shouldn't take the results as gospel. Mathematical image quality metrics do not always correlate perfectly with how humans perceive image quality, 
        and your personal preference is entirely subjective. You should take this page as what it is, a research that produces numbers, but you should not take these numbers for granted before 
        understanding what they actually mean.
    </p>
</section>
        <br>
        <br>
        <nav>
            <menu>
                <a href="../index.html">Home</a>
                <a href="#introduction">Introduction</a>
                <a href="https://github.com/Artoriuz">GitHub</a>
                <a href="https://www.linkedin.com/in/jvrchrisostomo/">LinkedIn</a>
            </menu>
        </nav>
        <br>
        <br>
</body>
</html>
